<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Why I Love F# for Mathematical Planning | Matthew Crews</title>

<meta name="keywords" content="" />
<meta name="description" content="A designer knows he has achieved perfection not when there is nothing left to add, but when there is nothing left to take away
 Antoine de Saint-Exupery   On my journey of growing as a developer, I am consistently inspired by language features which seem incredibly simple but yield remarkable benefit. As I try to master F#, I am frequently surprised by how powerful the language is for expressing ideas while having so few features.">
<meta name="author" content="">
<link rel="canonical" href="https://matthewcrews.com/blog/2020/12/2020-12-09/" />
<link href="/assets/css/stylesheet.min.d5d820de85dae34a78c22303e07aa685bb90ec25a056c702c0b1a964ca68861d.css" integrity="sha256-1dgg3oXa40p4wiMD4HqmhbuQ7CWgVscCwLGpZMpohh0=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://matthewcrews.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://matthewcrews.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://matthewcrews.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://matthewcrews.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://matthewcrews.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.78.2" />


<meta property="og:title" content="Why I Love F# for Mathematical Planning" />
<meta property="og:description" content="A designer knows he has achieved perfection not when there is nothing left to add, but when there is nothing left to take away
 Antoine de Saint-Exupery   On my journey of growing as a developer, I am consistently inspired by language features which seem incredibly simple but yield remarkable benefit. As I try to master F#, I am frequently surprised by how powerful the language is for expressing ideas while having so few features." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://matthewcrews.com/blog/2020/12/2020-12-09/" />
<meta property="article:published_time" content="2020-12-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-12-09T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why I Love F# for Mathematical Planning"/>
<meta name="twitter:description" content="A designer knows he has achieved perfection not when there is nothing left to add, but when there is nothing left to take away
 Antoine de Saint-Exupery   On my journey of growing as a developer, I am consistently inspired by language features which seem incredibly simple but yield remarkable benefit. As I try to master F#, I am frequently surprised by how powerful the language is for expressing ideas while having so few features."/>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Why I Love F# for Mathematical Planning",
  "name": "Why I Love F# for Mathematical Planning",
  "description": "A designer knows he has achieved perfection not when there is nothing left to add, but when there is nothing left to take away\n Antoine de Saint-Exupery   On my journey of growing …",
  "keywords": [
    
  ],
  "articleBody": " A designer knows he has achieved perfection not when there is nothing left to add, but when there is nothing left to take away\n Antoine de Saint-Exupery   On my journey of growing as a developer, I am consistently inspired by language features which seem incredibly simple but yield remarkable benefit. As I try to master F#, I am frequently surprised by how powerful the language is for expressing ideas while having so few features. Discussions frequently pop up about the need for ever more powerful abstractions, yet I find myself amazed by how far you can take the language with what is already there.\nI am no programming language expert, but I admire languages that maintain a lean feature set. Every new feature added to a language makes it just a little bit more difficult to fully understand and a little more intimidating for new developers. It is an impressive design feat when a language can remain approachable for beginners but enable the flexibility that library authors need.\nI am an Industrial Engineering turned Machine Learning Engineer, and I focus on the problem of maximizing the profitability and efficiency of companies. Often the solution involves a Mathematical Planning Model (aka Mathematical Programming). What I hope to do in the next few paragraphs is illustrate to you how some of the most basic features of F#, Discriminated Unions and Units of Measure, eliminate the most pernicious bugs when developing these models.\nThe Domain of Mathematical Planning The domain of Mathematical Planning is made up of Decisions, Constraints, and Objectives. A Decision is a choice that a business needs to make. It can be how many of Item X do we buy, do we build in Location A or Location B, or how many people do we assign to each job. Constraints are the rules we need to abide by. They are the limitations on what is possible. A Constraint could be that we only have 10 people available, or we can only build in Seattle or Portland, or we only have $1,000,000 to invest. The Objective is how we measure success. It is the function we want to maximize or minimize. We could minimize waste, maximize profit, or minimize cost.\nMany of my colleagues are building their models with Python. Python is a great language and I have been productive with it in the past. Here is a snippet of what a mathematical planning model may look like in Python:\n# Define a list of items to optimize for items = [\"A\", \"B\", \"C\"] # Define a list of locations to assign items to locations = [\"Portland\", \"Seattle\", \"Detroit\"] # Define a dictionary of revenue associated with each item and location tuple revenue = {(\"A\",\"Portland\"):1.5;, (\"A\",\"Seattle\"):1.7 ... } # Define a dictionary with the availability of each item availability = {\"A\":10.0, \"B\":20.0, \"C\":14.0} # Create a Decision for each Item, Location combination. This will be how much # of a given item we decide to send to that location allocation = LpVariable.dicts(\"AmountSent\",(items,locations), 0) # Create an instance of a `Problem` object and state that we want to maximize # the objective we give it problem = LpProblem(\"ItemAllocation\", LpMaximize) # We create an expression which evaluates the total revenue revenue_expr = lpSum([revenue[i][l] * allocation[i][l] for i in items for l in locations]) # We set the Objective of the Problem by adding it problem += revenue_expr, \"MaximizeRevenue\" # For each item in items, create a constraint which states that the total number # of items that is allocated cannot exceed the availability of the item for i in items: problem += lpSum([allocation[l][i] for l in location]  availability[i]) This is the beginning of a straightforward assignment problem. We have a list of items, items. For each item in items, we must decide how many we send to each location in locations. There is a limit on how much of each item is available for us to send. There is a revenue associated with sending a particular item to a given location. In this problem we want to maximize our revenue which is calculated by multiplying the decision for a given item and location by the revenue associated with it. Finally, we create a constraint for each item in items which states that the total number of a given item that is allocated cannot exceed the total that is available.\nThis is only part of the problem. Normally there would be more constraints that would make it more interesting. This is enough of a problem to illustrate my case though. There are two errors in this model already. If you were paying close attention you may have found one. I promise you cannot detect the second.\nThe Power of Domain Modeling Using Discriminated Unions F# provides two simple but powerful features which help ensure against the errors in the Python code. The first is Discriminated Unions. If we were to reformulate this problem using F#, the first thing we would do was define some simple types to model our domain.\ntype Item = Item of string type Location = Location of string Instead of just using strings to describe our Items and Locations, we create simple, single case Discriminated Unions (DU). These DUs provide context around what the strings are meant to represent. Let’s go ahead and create our item and locations lists again. This time, wrapping them in DUs.\nlet items = [\"A\"; \"B\"; \"C\"] | List.map Item let locations = [\"Portland\"; \"Seattle\"; \"Detroit\"] | List.map Location We will also update our availability information to use these new types.\nlet availability = [ Item \"A\", 10.0 Item \"B\", 20.0 Item \"C\", 14.0 ] | Map We will create the Decisions for each item and location. We store these Decision types in a Map which is indexed by an (Item * Location) tuple.\nlet allocation = DecisionBuilderServings \"AmountSent\" { for i in items do for l in locations - Continuous (0.0, infinity) } | Map We now attempt to create the same constraints we did in Python with a direct translation.\nlet allocationContraints = ConstraintBuilder \"ItemLimit\" { for i in items - List.sum [for l in locations - 1.0 * allocation[l, i]]  availability.[i] } Except, the compiler is gives us an error on the indexing of allocation.\nWhat some of you may have noticed in the Python code is that the allocation collection is indexed by an Item then Location. The original code was trying to access it by location then by item. This would have thrown an error at runtime due to a missing value. In F# this becomes a compiler error. The type system itself it is helping you. This may seem small, but this is one of the most painful types of errors when debugging a Mathematical Planning model.\nSomeone may say that this can be accomplished in other languages and I would agree. I believe where F# is unique is in the simplicity and ease of using single case Discriminated Unions for wrapping primitives. It is virtually no additional effort.\nUnits of Measure: The Achilles Heel of Numbers There is an underappreciated problem in software development, numbers are rarely just numbers. They represent something: cm, feet, kg, or meters. Normally we do not care about a raw number. Our primary concern is with what the number represents. In most languages there are no easy mechanisms for tracking the Units of Measure associated with a number. F# on the other hand has baked the concept of a Unit of Measure into the type system.\nThe Units of Measure feature will reveal the second problem with the Python code that otherwise may remain undetected. Let’s update our domain with some new types to track the units on our numbers.\n[Measure] type Servings [Measure] type Kg We now have units to represent Servings and Kg. Let’s update our availability collection to store numbers with these units attached.\nlet availability = [ Item \"A\", 10.0Kg Item \"B\", 20.0Kg Item \"C\", 14.0Kg ] | Map We have now provided more context around our availability numbers. We now know they are stored in units of Kg. The F# compiler will enforce correct algebra as we work with them. We now update our Decisions to be in units of Servings.\nlet allocation = DecisionBuilderServings \"AmountSent\" { for i in items do for l in locations - Continuous (0.0Servings, 1_000_000.0Servings) } | Map With our Decisions updated, we go back to our constraint definition and we now see a new bug.\nThe important part of this message is at the bottom. The compiler is complaining that the left-hand is in units of Servings and the right-hand side is in units of Kg. It does not make sense to compare values that are in different units, so the compiler is throwing an error. In other languages this error would go undetected. Worse, it may not even be caught in unit testing because the math will still work, it just won’t give correct results.\nLet’s go ahead and add some conversion data so that we can fix this.\nlet itemMass = [ Item \"A\", 1.1Kg/Servings Item \"B\", 2.0Kg/Servings Item \"C\", 0.7Kg/Servings ] | Map We now have data which will allow us to convert from Serving to Kg. Let’s incorporate it into our constraint creation expression.\nlet allocationContraints = ConstraintBuilder \"ItemLimit\" { for i in items - List.sum [for l in locations - itemMass[i] * itemAllocation[i, l]]  availability[i] } Now the compiler is happy because the units are in Kg on both sides. This simple feature of ensuring correct Units of Measure eliminates what is possibly the most nefarious bug in Mathematical Planning. It would be hard to calculate the number of hours wasted on badly formulated models due to mismatched Units of Measure.\nSimple Building Blocks F# is an incredibly expressive language while staying lean on the number of features. Other languages have taken the approach of throwing every possible feature in. F# is relatively slow to incorporate new features and they are always purposeful. Most of the time the feature is orthogonal to the rest of the language. This is keeping the language approachable for newcomers so the climb to mastery is not nearly as steep. I believe these two simple features, Discriminated Unions and Units of Measure, uniquely position F# as an awesome language for Mathematical Planning.\n",
  "wordCount" : "1723",
  "inLanguage": "en",
  "datePublished": "2020-12-09T00:00:00Z",
  "dateModified": "2020-12-09T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://matthewcrews.com/blog/2020/12/2020-12-09/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Matthew Crews",
    "logo": {
      "@type": "ImageObject",
      "url": "https://matthewcrews.com/favicon.ico"
    }
  }
}
</script>



</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        .theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://matthewcrews.com" accesskey="h" title="Matthew Crews (Alt + H)">Matthew Crews</a>
            <span class="logo-switches">
                <span class="theme-toggle" title="(Alt + T)">
                    <a id="theme-toggle" accesskey="t">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </a>
                </span>
                
            </span>
        </div>
        <ul class="menu" id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://matthewcrews.com/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://matthewcrews.com/consulting" title="Consulting">
                    <span>Consulting</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">
      Why I Love F# for Mathematical Planning
    </h1>
    <div class="post-description">
      
    </div>
    <div class="post-meta">December 9, 2020

    </div>
  </header> 

  <div class="post-content">
<blockquote>
<p>A designer knows he has achieved perfection not when there is nothing left to add, but when there is nothing left to take away</p>
<ul>
<li>Antoine de Saint-Exupery</li>
</ul>
</blockquote>
<p>On my journey of growing as a developer, I am consistently inspired by language features which seem incredibly simple but yield remarkable benefit. As I try to master F#, I am frequently surprised by how powerful the language is for expressing ideas while having so few features. Discussions frequently pop up about the need for ever more powerful abstractions, yet I find myself amazed by how far you can take the language with what is already there.</p>
<p>I am no programming language expert, but I admire languages that maintain a lean feature set. Every new feature added to a language makes it just a little bit more difficult to fully understand and a little more intimidating for new developers. It is an impressive design feat when a language can remain approachable for beginners but enable the flexibility that library authors need.</p>
<p>I am an Industrial Engineering turned Machine Learning Engineer, and I focus on the problem of maximizing the profitability and efficiency of companies. Often the solution involves a Mathematical Planning Model (aka Mathematical Programming). What I hope to do in the next few paragraphs is illustrate to you how some of the most basic features of F#, Discriminated Unions and Units of Measure, eliminate the most pernicious bugs when developing these models.</p>
<h2 id="the-domain-of-mathematical-planning">The Domain of Mathematical Planning<a hidden class="anchor" aria-hidden="true" href="#the-domain-of-mathematical-planning">#</a></h2>
<p>The domain of Mathematical Planning is made up of Decisions, Constraints, and Objectives. A Decision is a choice that a business needs to make. It can be how many of Item X do we buy, do we build in Location A or Location B, or how many people do we assign to each job. Constraints are the rules we need to abide by. They are the limitations on what is possible. A Constraint could be that we only have 10 people available, or we can only build in Seattle or Portland, or we only have $1,000,000 to invest. The Objective is how we measure success. It is the function we want to maximize or minimize. We could minimize waste, maximize profit, or minimize cost.</p>
<p>Many of my colleagues are building their models with Python. Python is a great language and I have been productive with it in the past. Here is a snippet of what a mathematical planning model may look like in Python:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Define a list of items to optimize for</span>
items <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>, <span style="color:#e6db74">&#34;C&#34;</span>]

<span style="color:#75715e"># Define a list of locations to assign items to</span>
locations <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Portland&#34;</span>, <span style="color:#e6db74">&#34;Seattle&#34;</span>, <span style="color:#e6db74">&#34;Detroit&#34;</span>]

<span style="color:#75715e"># Define a dictionary of revenue associated with each item and location tuple</span>
revenue <span style="color:#f92672">=</span> {(<span style="color:#e6db74">&#34;A&#34;</span>,<span style="color:#e6db74">&#34;Portland&#34;</span>):<span style="color:#ae81ff">1.5</span>;, (<span style="color:#e6db74">&#34;A&#34;</span>,<span style="color:#e6db74">&#34;Seattle&#34;</span>):<span style="color:#ae81ff">1.7</span> <span style="color:#f92672">...</span> }

<span style="color:#75715e"># Define a dictionary with the availability of each item</span>
availability <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;A&#34;</span>:<span style="color:#ae81ff">10.0</span>, <span style="color:#e6db74">&#34;B&#34;</span>:<span style="color:#ae81ff">20.0</span>, <span style="color:#e6db74">&#34;C&#34;</span>:<span style="color:#ae81ff">14.0</span>}

<span style="color:#75715e"># Create a Decision for each Item, Location combination. This will be how much</span>
<span style="color:#75715e"># of a given item we decide to send to that location</span>
allocation <span style="color:#f92672">=</span> LpVariable<span style="color:#f92672">.</span>dicts(<span style="color:#e6db74">&#34;AmountSent&#34;</span>,(items,locations), <span style="color:#ae81ff">0</span>)

<span style="color:#75715e"># Create an instance of a `Problem` object and state that we want to maximize</span>
<span style="color:#75715e"># the objective we give it</span>
problem <span style="color:#f92672">=</span> LpProblem(<span style="color:#e6db74">&#34;ItemAllocation&#34;</span>, LpMaximize)

<span style="color:#75715e"># We create an expression which evaluates the total revenue</span>
revenue_expr <span style="color:#f92672">=</span>
    lpSum([revenue[i][l] <span style="color:#f92672">*</span> allocation[i][l] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> items <span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> locations])

<span style="color:#75715e"># We set the Objective of the Problem by adding it</span>
problem <span style="color:#f92672">+=</span> revenue_expr, <span style="color:#e6db74">&#34;MaximizeRevenue&#34;</span>

<span style="color:#75715e"># For each item in items, create a constraint which states that the total number</span>
<span style="color:#75715e"># of items that is allocated cannot exceed the availability of the item</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> items:
    problem <span style="color:#f92672">+=</span> lpSum([allocation[l][i] <span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> location] <span style="color:#f92672">&lt;=</span> availability[i])

</code></pre></div><p>This is the beginning of a straightforward assignment problem. We have a list of items, <code>items</code>. For each <code>item</code> in <code>items</code>, we must decide how many we send to each <code>location</code> in <code>locations</code>. There is a limit on how much of each <code>item</code> is available for us to send. There is a revenue associated with sending a particular <code>item</code> to a given <code>location</code>. In this problem we want to maximize our revenue which is calculated by multiplying the <code>decision</code> for a given <code>item</code> and <code>location</code> by the <code>revenue</code> associated with it. Finally, we create a constraint for each <code>item</code> in <code>items</code> which states that the total number of a given <code>item</code> that is allocated cannot exceed the total that is available.</p>
<p>This is only part of the problem. Normally there would be more constraints that would make it more interesting. This is enough of a problem to illustrate my case though. There are two errors in this model already. If you were paying close attention you may have found one. I promise you cannot detect the second.</p>
<h2 id="the-power-of-domain-modeling-using-discriminated-unions">The Power of Domain Modeling Using Discriminated Unions<a hidden class="anchor" aria-hidden="true" href="#the-power-of-domain-modeling-using-discriminated-unions">#</a></h2>
<p>F# provides two simple but powerful features which help ensure against the errors in the Python code. The first is Discriminated Unions. If we were to reformulate this problem using F#, the first thing we would do was define some simple types to model our domain.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Item</span> <span style="color:#f92672">=</span> Item <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">string</span>
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Location</span> <span style="color:#f92672">=</span> Location <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">string</span>
</code></pre></div><p>Instead of just using strings to describe our Items and Locations, we create simple, single case Discriminated Unions (DU). These DUs provide context around what the strings are meant to represent. Let&rsquo;s go ahead and create our <code>item</code> and <code>locations</code> lists again. This time, wrapping them in DUs.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> 
  <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">;</span> <span style="color:#e6db74">&#34;B&#34;</span><span style="color:#f92672">;</span> <span style="color:#e6db74">&#34;C&#34;</span><span style="color:#f92672">]</span> 
  <span style="color:#f92672">|&gt;</span> List.map Item

<span style="color:#66d9ef">let</span> locations <span style="color:#f92672">=</span> 
  <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Portland&#34;</span><span style="color:#f92672">;</span> <span style="color:#e6db74">&#34;Seattle&#34;</span><span style="color:#f92672">;</span> <span style="color:#e6db74">&#34;Detroit&#34;</span><span style="color:#f92672">]</span>
  <span style="color:#f92672">|&gt;</span> List.map Location
</code></pre></div><p>We will also update our <code>availability</code> information to use these new types.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> availability <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span>
        Item <span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">,</span> 10<span style="color:#f92672">.</span>0
        Item <span style="color:#e6db74">&#34;B&#34;</span><span style="color:#f92672">,</span> 20<span style="color:#f92672">.</span>0
        Item <span style="color:#e6db74">&#34;C&#34;</span><span style="color:#f92672">,</span> 14<span style="color:#f92672">.</span>0
    <span style="color:#f92672">]</span> <span style="color:#f92672">|&gt;</span> Map
</code></pre></div><p>We will create the Decisions for each <code>item</code> and <code>location</code>. We store these <code>Decision</code> types in a <code>Map</code> which is indexed by an <code>(Item * Location)</code> tuple.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> allocation <span style="color:#f92672">=</span>
    DecisionBuilder<span style="color:#f92672">&lt;</span>Servings<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;AmountSent&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> items <span style="color:#66d9ef">do</span>
            <span style="color:#66d9ef">for</span> l <span style="color:#66d9ef">in</span> locations <span style="color:#f92672">-&gt;</span>
                Continuous <span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> infinity<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span> <span style="color:#f92672">|&gt;</span> Map
</code></pre></div><p>We now attempt to create the same constraints we did in Python with a direct translation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> allocationContraints <span style="color:#f92672">=</span>
    ConstraintBuilder <span style="color:#e6db74">&#34;ItemLimit&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> items <span style="color:#f92672">-&gt;</span>
            List.sum <span style="color:#f92672">[</span><span style="color:#66d9ef">for</span> l <span style="color:#66d9ef">in</span> locations <span style="color:#f92672">-&gt;</span> 1<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> allocation<span style="color:#f92672">[</span>l<span style="color:#f92672">,</span> i<span style="color:#f92672">]]</span> <span style="color:#f92672">&lt;==</span> availability<span style="color:#f92672">.[</span>i<span style="color:#f92672">]</span>
    <span style="color:#f92672">}</span>   
</code></pre></div><p>Except, the compiler is gives us an error on the indexing of <code>allocation</code>.</p>
<p><img src="/img/2020-12-08-indexing-error.png" alt="Compiler error for indexing Map"></p>
<p>What some of you may have noticed in the Python code is that the <code>allocation</code> collection is indexed by an <code>Item</code> then <code>Location</code>. The original code was trying to access it by <code>location</code> then by <code>item</code>. This would have thrown an error at runtime due to a missing value. In F# this becomes a compiler error. The type system itself it is helping you. This may seem small, but this is one of the most painful types of errors when debugging a Mathematical Planning model.</p>
<p>Someone may say that this can be accomplished in other languages and I would agree. I believe where F# is unique is in the simplicity and ease of using single case Discriminated Unions for wrapping primitives. It is virtually no additional effort.</p>
<h2 id="units-of-measure-the-achilles-heel-of-numbers">Units of Measure: The Achilles Heel of Numbers<a hidden class="anchor" aria-hidden="true" href="#units-of-measure-the-achilles-heel-of-numbers">#</a></h2>
<p>There is an underappreciated problem in software development, numbers are rarely just numbers. They represent something: <code>cm</code>, <code>feet</code>, <code>kg</code>, or <code>meters</code>. Normally we do not care about a raw number. Our primary concern is with what the number represents. In most languages there are no easy mechanisms for tracking the Units of Measure associated with a number. F# on the other hand has baked the concept of a Unit of Measure into the type system.</p>
<p>The Units of Measure feature will reveal the second problem with the Python code that otherwise may remain undetected. Let&rsquo;s update our domain with some new types to track the units on our numbers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#f92672">[&lt;</span>Measure<span style="color:#f92672">&gt;]</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Servings</span>
<span style="color:#f92672">[&lt;</span>Measure<span style="color:#f92672">&gt;]</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Kg</span>
</code></pre></div><p>We now have units to represent <code>Servings</code> and <code>Kg</code>. Let&rsquo;s update our <code>availability</code> collection to store numbers with these units attached.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> availability <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span>
        Item <span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">,</span> 10<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>Kg<span style="color:#f92672">&gt;</span>
        Item <span style="color:#e6db74">&#34;B&#34;</span><span style="color:#f92672">,</span> 20<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>Kg<span style="color:#f92672">&gt;</span>
        Item <span style="color:#e6db74">&#34;C&#34;</span><span style="color:#f92672">,</span> 14<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>Kg<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">]</span> <span style="color:#f92672">|&gt;</span> Map
</code></pre></div><p>We have now provided more context around our availability numbers. We now know they are stored in units of <code>Kg</code>. The F# compiler will enforce correct algebra as we work with them. We now update our Decisions to be in units of <code>Servings</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> allocation <span style="color:#f92672">=</span>
    DecisionBuilder<span style="color:#f92672">&lt;</span>Servings<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;AmountSent&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> items <span style="color:#66d9ef">do</span>
            <span style="color:#66d9ef">for</span> l <span style="color:#66d9ef">in</span> locations <span style="color:#f92672">-&gt;</span>
                Continuous <span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>Servings<span style="color:#f92672">&gt;,</span> 1_000_000<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>Servings<span style="color:#f92672">&gt;)</span>
    <span style="color:#f92672">}</span> <span style="color:#f92672">|&gt;</span> Map
</code></pre></div><p>With our Decisions updated, we go back to our constraint definition and we now see a new bug.</p>
<p><img src="/img/2020-12-08-units-of-measure-mismatch.png" alt="Units of Measure Mismatch"></p>
<p>The important part of this message is at the bottom. The compiler is complaining that the left-hand is in units of <code>Servings</code> and the right-hand side is in units of <code>Kg</code>. It does not make sense to compare values that are in different units, so the compiler is throwing an error. In other languages this error would go undetected. Worse, it may not even be caught in unit testing because the math will still work, it just won&rsquo;t give correct results.</p>
<p>Let&rsquo;s go ahead and add some conversion data so that we can fix this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> itemMass <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span>
        Item <span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>1<span style="color:#f92672">&lt;</span>Kg<span style="color:#f92672">/</span>Servings<span style="color:#f92672">&gt;</span>
        Item <span style="color:#e6db74">&#34;B&#34;</span><span style="color:#f92672">,</span> 2<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>Kg<span style="color:#f92672">/</span>Servings<span style="color:#f92672">&gt;</span>
        Item <span style="color:#e6db74">&#34;C&#34;</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">.</span>7<span style="color:#f92672">&lt;</span>Kg<span style="color:#f92672">/</span>Servings<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">]</span> <span style="color:#f92672">|&gt;</span> Map
</code></pre></div><p>We now have data which will allow us to convert from <code>Serving</code> to <code>Kg</code>. Let&rsquo;s incorporate it into our constraint creation expression.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> allocationContraints <span style="color:#f92672">=</span>
  ConstraintBuilder <span style="color:#e6db74">&#34;ItemLimit&#34;</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> items <span style="color:#f92672">-&gt;</span>
      List.sum <span style="color:#f92672">[</span><span style="color:#66d9ef">for</span> l <span style="color:#66d9ef">in</span> locations <span style="color:#f92672">-&gt;</span> itemMass<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> itemAllocation<span style="color:#f92672">[</span>i<span style="color:#f92672">,</span> l<span style="color:#f92672">]]</span> <span style="color:#f92672">&lt;==</span> availability<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>
  <span style="color:#f92672">}</span> 
</code></pre></div><p>Now the compiler is happy because the units are in <code>Kg</code> on both sides. This simple feature of ensuring correct Units of Measure eliminates what is possibly the most nefarious bug in Mathematical Planning. It would be hard to calculate the number of hours wasted on badly formulated models due to mismatched Units of Measure.</p>
<h2 id="simple-building-blocks">Simple Building Blocks<a hidden class="anchor" aria-hidden="true" href="#simple-building-blocks">#</a></h2>
<p>F# is an incredibly expressive language while staying lean on the number of features. Other languages have taken the approach of throwing every possible feature in. F# is relatively slow to incorporate new features and they are always purposeful. Most of the time the feature is orthogonal to the rest of the language. This is keeping the language approachable for newcomers so the climb to mastery is not nearly as steep. I believe these two simple features, Discriminated Unions and Units of Measure, uniquely position F# as an awesome language for Mathematical Planning.</p>

</div>
  <footer class="post-footer">



<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Why I Love F# for Mathematical Planning on twitter"
        href="https://twitter.com/intent/tweet/?text=Why%20I%20Love%20F%23%20for%20Mathematical%20Planning&amp;url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2020%2f12%2f2020-12-09%2f&amp;hashtags=">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Why I Love F# for Mathematical Planning on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2020%2f12%2f2020-12-09%2f&amp;title=Why%20I%20Love%20F%23%20for%20Mathematical%20Planning&amp;summary=Why%20I%20Love%20F%23%20for%20Mathematical%20Planning&amp;source=https%3a%2f%2fmatthewcrews.com%2fblog%2f2020%2f12%2f2020-12-09%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Why I Love F# for Mathematical Planning on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2020%2f12%2f2020-12-09%2f&title=Why%20I%20Love%20F%23%20for%20Mathematical%20Planning">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Why I Love F# for Mathematical Planning on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmatthewcrews.com%2fblog%2f2020%2f12%2f2020-12-09%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Why I Love F# for Mathematical Planning on whatsapp"
        href="https://api.whatsapp.com/send?text=Why%20I%20Love%20F%23%20for%20Mathematical%20Planning%20-%20https%3a%2f%2fmatthewcrews.com%2fblog%2f2020%2f12%2f2020-12-09%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Why I Love F# for Mathematical Planning on telegram"
        href="https://telegram.me/share/url?text=Why%20I%20Love%20F%23%20for%20Mathematical%20Planning&amp;url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2020%2f12%2f2020-12-09%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2021 <a href="https://matthewcrews.com">Matthew Crews</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>



<script defer src="/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js" integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.replaceState(null, null, `#${id}`);
            }
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
    };
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
</body>

</html>
