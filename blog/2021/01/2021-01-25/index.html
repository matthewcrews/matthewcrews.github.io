<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Scheduling Jobs for Maximum Efficiency - Part 1 | Matthew Crews</title>

<meta name="keywords" content="" />
<meta name="description" content="I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, &ldquo;Absolutely!&rdquo; I am abstracting away the specific domain, but this is the essence of the problem.
There are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C.">
<meta name="author" content="">
<link rel="canonical" href="https://matthewcrews.com/blog/2021/01/2021-01-25/" />
<link href="/assets/css/stylesheet.min.d5d820de85dae34a78c22303e07aa685bb90ec25a056c702c0b1a964ca68861d.css" integrity="sha256-1dgg3oXa40p4wiMD4HqmhbuQ7CWgVscCwLGpZMpohh0=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://matthewcrews.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://matthewcrews.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://matthewcrews.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://matthewcrews.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://matthewcrews.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.78.2" />


<meta property="og:title" content="Scheduling Jobs for Maximum Efficiency - Part 1" />
<meta property="og:description" content="I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, &ldquo;Absolutely!&rdquo; I am abstracting away the specific domain, but this is the essence of the problem.
There are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://matthewcrews.com/blog/2021/01/2021-01-25/" />
<meta property="article:published_time" content="2021-01-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Scheduling Jobs for Maximum Efficiency - Part 1"/>
<meta name="twitter:description" content="I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, &ldquo;Absolutely!&rdquo; I am abstracting away the specific domain, but this is the essence of the problem.
There are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C."/>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Scheduling Jobs for Maximum Efficiency - Part 1",
  "name": "Scheduling Jobs for Maximum Efficiency - Part 1",
  "description": "I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I …",
  "keywords": [
    
  ],
  "articleBody": "I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, “Absolutely!” I am abstracting away the specific domain, but this is the essence of the problem.\nThere are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C. Each machine has different job-types that it can process. Some machines can process any job-type while other machines can only work on one or two. At the beginning of the day, we are given a set of jobs to assign to the machines. We want to assign jobs to machines such that a) the machines are evenly loaded and b) we minimize the number of different job-types each machine must process.\nAn ideal plan would have each machine with the same amount of work and only processing a single job-type. The reason we want a machine to only process a single job-type is to minimize the waste associated with changing between job-types. Switching between job-types is fast, it just creates unwanted waste. Let’s start with creating a small domain model and generate some example data.\n Note: You can find the full code example for this post here\n A Domain for Job Assignments Based on the description there are some clear types that we need to define: Machine, Job, and JobType.\n[RequireQualifiedAccess] type JobType = | A | B | C type Job = { Id : int JobType : JobType Size : float } with override this.ToString () = $\"Job_{this.Id}\" type Machine = { Id : int JobTypes : SetJobType } with override this.ToString () = $\"Machine_{this.Id}\" I like to override the ToString method because the ConstraintBuilder and DecisionBuilder in Flips use ToString for the naming of constraints and decisions. JobType is a straightforward Discriminated Union with three different cases A, B, and C. Job has an Id field for identifying a particular Job, a JobType which describes the type of job that it is, and the Size.\nThe Machine type has an Id field and a JobTypes field. The JobTypes field is a Set of JobType. This represents the jobs the Machine can process.\nWe now want to setup some data for us to be able to play with. These will be the parameters which will help us generate random data for us to work with.\n// Set of JobTypes for iterating over and sampling from let jobTypes = [| JobType.A JobType.B JobType.C |] // Some theoretical JobTypeSets to be used in generating // random Machines let jobTypeSets = [| Set jobTypes Set jobTypes.[1..] Set jobTypes.[..1] |] // Setting up parameters for the example let rng = System.Random(123) let numberOfJobs = 20 let numberOfMachines = 5 let minJobSize = 1 let maxJobSize = 3 let maxWorkDifference = 2.0 jobTypes is an Array which holds each of the possible JobType cases. We will use this to create random jobs. The jobTypeSets value is an Array of Set. These are the possible values for the JobTypes field of Machine that we will use for generating random machines. For this example, we will have 20 jobs and 5 machines to assign them to. minJobSize will control how small a job can be and maxJobSize will determine how large. The maxWorkDifference parameter will determine how different the loading of machines that we will allow.\nWe now create some convenience functions for generating random data. We will also add a function for looking up a key in a Map but returning a default value when the key is not present.\nlet randomJobSize (rng: System.Random) = rng.Next(minJobSize, maxJobSize) | float let randomJobType (rng: System.Random) = jobTypes.[rng.Next(0, jobTypes.Length)] let randomJobTypeSet (rng: System.Random) = jobTypeSets.[rng.Next(0, jobTypeSets.Length)] module Map = // Useful when you want to look up a key in a Map but you want it to provide  // a default value if the key is missing  let tryFindDefault (key: 'a) (defaultValue: 'v) (m: Map'a, 'v) = match Map.tryFind key m with | Some v - v | None - defaultValue We can now generate a random set of jobs and machines to work with.\n// Create some examples jobs let jobs = [1..numberOfJobs] | List.map (fun id - { Id = id JobType = randomJobType rng Length = randomJobSize rng }) // Create some test machines let machines = [1..numberOfMachines] | List.map (fun id - { Id = id JobTypes = randomJobTypeSet rng }) Formulating the Problem Now that we have some data to work with, we can get to formulating our model. Let’s go ahead and open Flips. I love working with VS Code, Ionide, and .fsx files for this kind of exploration. The new #r \"nuget: \" syntax for using Nuget packages has been a game changer.\n#r \"nuget: Flips\" open Flips open Flips.Types open Flips.SliceMap We want to create a Map where they key is a JobType and the value is a list of Job that are of that type. This will make it easy for us to lookup the Jobs of a given type.\n// A Map from JobType to the Jobs which are of that type let jobsForJobType = jobs | List.groupBy (fun job - job.JobType) | Map We now want to create a 1-dimensional SliceMap where the 'key is a Job and the 'value is the size of the job. This will make it easy for us to sum up how much work has been assigned to a Machine.\n// A SliceMap where the key is a Job and the value is the size of the Job let jobSizes = jobs | List.map (fun job - job, job.Size) | SMap Now let’s create the set of Decisions which will represent us assigning a Job to a Machine. We will store this in a 3-dimensional SliceMap keyed by the Machine, the JobType, and finally the Job. The reason we key by the JobType will become apparent later in the formulation. We will use a Boolean decision where 1.0 indicates that we are assigning the Job to a Machine and 0.0 indicates not.\n// The Decisions which represent assigning a Job to a Machine // The JobType index allows us to slice along the job type // which is useful in some of the constraints let assignments = DecisionBuilder \"Assignment\" { for machine in machines do for jobType in machine.JobTypes do for job in Map.tryFindDefault jobType [] jobsForJobType - Boolean } | SMap3 Now that we have these decisions which represent assigning a job to a machine, we can formulate our first and most obvious constraints. Each job must be assigned to one machine. For each job we say that the sum of assignments for a given job across all machines and all job-types must be 1.0. This forces the solver to find a solution where each job is assigned once.\n// Each job must be assigned let jobsAssignmentConstraints = ConstraintBuilder \"JobAssignment\" { for job in jobs - sum assignments.[All, All, job] == 1.0 } Constraint or Objective? We now come to an interesting question. Our original problem statement said that we want to minimize the number of different job-types a machine must deal with. Ideally each machine only works on a single job-type. We also said that we want the machines evenly loaded. When I was chatting with my friend I dug into this point. Which one of these objectives is more important because we can’t optimize for both? This is where a modeler needs to work with their client to help them understand what the most important thing is truly.\nIn our case, minimizing the different job-types for machines was the most important, so long as the machines were not too unevenly loaded. This means that the goal for even loading becomes a constraint and the objective remains the minimization of different job-types for machines. We will explore variations of this problem in future posts.\nControlling the Difference in Loading Now that we have decided that even machine loading needs to be a constraint, we need to create some Decisions to control for it. We will create two Decisions. One will represent the value of the machine with the greatest loading and the other the machine with the least loading.\n// A Decision which is meant to represent the MaxWork value across all Machines let maxWork = Decision.createContinuous \"MaxWork\" 0.0 infinity // A Decision which is meant to represent the MinWork value across all Machines let minWork = Decision.createContinuous \"MinWork\" 0.0 infinity Now, we want to create a Constraint which states that the difference between these two values is not greater than the maximum allowed difference.\n// We constrain the difference between the most heavily loaded machine // and the least loaded let maxWorkDifferenceConstraint = Constraint.create \"MaxWorkDifferent\" (maxWork - minWork  maxWorkDifference) Okay, that’s great but will it do anything? Right now, there is nothing that forces the maxWork decision to be equal to the loading of the most heavily loaded machine. There’s also nothing which forces minWork to be equal to the loading of the most lightly loaded machine. The solver could set the values to 0.0 and be done with it. We need to create some constraints which will force maxWork and minWork to take on the loading of the most heavily and most lightly loaded machines.\nLet’s create some constraints which state that the value of the maxWork decision must be greater than or equal to the loading of all the machines. This will force it to be a value above or equal to the maximum loading.\n// The maxWork Decision must be greater or equal to all of the total work // for each Machine let maxWorkConstraints = ConstraintBuilder \"MaxWork\" { for machine in machines - maxWork == sum (assignments.[machine, All, All] .* jobSizes) } We do a similar thing for the minWork decision. In this case we will say that minWork must be less than or equal to all the loadings of the machines.\n// The minWork Decision must be less or equal to all of the total work // for each Machine let minWorkConstraints = ConstraintBuilder \"MinWork\" { for machine in machines - minWork  sum (assignments.[machine, All, All] .* jobSizes) } maxWorkConstraints and minWorkConstraints will force maxWork and minWork to take on the values of the most heavily and lightly loaded machines respectively. maxWorkDifferenceConstraint states that the difference between maxWork and minWork must be within the permissable bounds. All together these constraints will prevent the solver from distributing jobs across machines unevenly.\nMinimizing the Job-Types for Machines We now need to quantify how many different job-types are being assigned to machines. To do this, we will create a set of Boolean decisions which will indicate whether we have decided to assign a job of a given job-type to a machine. We will store these in a 2-dimensional SliceMap where the keys are the Machine and the JobType. 1 will represent that we have decided to assign a given JobType to a Machine. 0 will indicate that we did not. I like to think of this as “turning on” or “turning off” the job-type for the machine. We will call these decisions the setups decisions.\n// A Decision which indicates whether we setup a given Machine for a // JobType at any point let setups = DecisionBuilder \"Setups\" { for machine in machines do for jobType in jobTypes - Boolean } | SMap2 We now want to create some constraints which will force the solver to turn on the decision to allow the assigning of a job-type to a machine. We will do this by saying that the sum of jobs of a given job-type must be less than or equal to our decision to assign that job-type to the machine multiplied by a large number. This will force the solver to “turn on” the job-type for the machine. In our case the “large number” will be the total number of jobs.\n// We must turn the setups value for a given Machine and JobType to 1 // if we assign a Job of the given JobType to the Machine let setupConstraints = ConstraintBuilder \"SetupRequired\" { for machine in machines do for jobType in jobTypes - sum (assignments.[machine, jobType, All])  (float numberOfJobs) * setups.[machine, jobType] } We can now create an expression which represents the number of different job-types that are assigned to machines.\n// An expression which is the sum of the Setups that will need to be performed let numberSetupsExpression = sum setups We use this expression to create our objective of minimizing the number of different job-types assigned to a machine.\n// We want to minimize the number of setups let minSetupsObjective = Objective.create \"MinSetups\" Minimize numberSetupsExpression We can now compose our model from the parts that we have created.\n// Compose the model let model = Model.create minSetupsObjective | Model.addConstraints jobsAssignmentConstraints | Model.addConstraints maxWorkConstraints | Model.addConstraints minWorkConstraints | Model.addConstraint maxWorkDifferenceConstraint | Model.addConstraints setupConstraints We now ask the solver to find us a solution.\n// Give the solver plenty of time to find a solution let settings = { Settings.basic with MaxDuration = 60_000L } let result = Solver.solve settings model If you want to see the code that prints out the results you can check it out here. This is the solution the solver found.\nAssignments:\rMachine: 1\rJob: 4\rJob: 7\rJob: 8\rJob: 11\rMachine: 2\rJob: 16\rJob: 18\rJob: 20\rMachine: 3\rJob: 1\rJob: 3\rJob: 6\rJob: 12\rJob: 17\rJob: 19\rMachine: 4\rJob: 2\rJob: 13\rJob: 14\rMachine: 5\rJob: 5\rJob: 9\rJob: 10\rJob: 15\rMachine Loading:\rMachine: 1 | Total Load: 5\rMachine: 2 | Total Load: 5\rMachine: 3 | Total Load: 7\rMachine: 4 | Total Load: 6\rMachine: 5 | Total Load: 6\rMax Diffence In Loading: 2\rNext Steps We’ve only begone to explore this model. There are quite a few variations and nuances that I will dive into in the posts to come. In the future we will discuss adding machine capacity and dealing with infeasible models. We will also explore adding restrictions on just how much of a job-type can be assigned to a given machine. Some job-types cause more wear and therefore we do not want too much assigned to a single machine. We will also look at needing to re-plan part way through the day and look at scheduling over a longer time horizon.\nThese types of scheduling problems are common and therefore it’s valuable for us to explore how we can play and tweak with this model to make it suit our needs. Feel free to reach out with questions and ideas for modeling challenges in the future!\n",
  "wordCount" : "2468",
  "inLanguage": "en",
  "datePublished": "2021-01-25T00:00:00Z",
  "dateModified": "2021-01-25T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://matthewcrews.com/blog/2021/01/2021-01-25/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Matthew Crews",
    "logo": {
      "@type": "ImageObject",
      "url": "https://matthewcrews.com/favicon.ico"
    }
  }
}
</script>



</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        .theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://matthewcrews.com" accesskey="h" title="Matthew Crews (Alt + H)">Matthew Crews</a>
            <span class="logo-switches">
                <span class="theme-toggle" title="(Alt + T)">
                    <a id="theme-toggle" accesskey="t">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </a>
                </span>
                
            </span>
        </div>
        <ul class="menu" id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://matthewcrews.com/about" title="About">
                    <span>About</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">
      Scheduling Jobs for Maximum Efficiency - Part 1
    </h1>
    <div class="post-description">
      
    </div>
    <div class="post-meta">January 25, 2021

    </div>
  </header> 

  <div class="post-content">
<p>I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, &ldquo;Absolutely!&rdquo; I am abstracting away the specific domain, but this is the essence of the problem.</p>
<p>There are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C. Each machine has different job-types that it can process. Some machines can process any job-type while other machines can only work on one or two. At the beginning of the day, we are given a set of jobs to assign to the machines. We want to assign jobs to machines such that a) the machines are evenly loaded and b) we minimize the number of different job-types each machine must process.</p>
<p>An ideal plan would have each machine with the same amount of work and only processing a single job-type. The reason we want a machine to only process a single job-type is to minimize the waste associated with changing between job-types. Switching between job-types is fast, it just creates unwanted waste. Let&rsquo;s start with creating a small domain model and generate some example data.</p>
<blockquote>
<p><strong>Note</strong>: You can find the full code example for this post <a href="https://github.com/matthewcrews/modelmondays/blob/main/2021-01-22-MachineAllocation/2021-01-22-MachineAllocation.fsx">here</a></p>
</blockquote>
<h2 id="a-domain-for-job-assignments">A Domain for Job Assignments<a hidden class="anchor" aria-hidden="true" href="#a-domain-for-job-assignments">#</a></h2>
<p>Based on the description there are some clear types that we need to define: <code>Machine</code>, <code>Job</code>, and <code>JobType</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#f92672">[&lt;</span>RequireQualifiedAccess<span style="color:#f92672">&gt;]</span>
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">JobType</span> <span style="color:#f92672">=</span>
    <span style="color:#f92672">|</span> A
    <span style="color:#f92672">|</span> B
    <span style="color:#f92672">|</span> C

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Job</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    Id <span style="color:#f92672">:</span> int
    JobType <span style="color:#f92672">:</span> JobType
    Size <span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">with</span>
    <span style="color:#66d9ef">override</span> this.<span style="color:#a6e22e">ToString</span> () <span style="color:#f92672">=</span>
        <span style="color:#f92672">$</span><span style="color:#e6db74">&#34;Job_{this.Id}&#34;</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Machine</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    Id <span style="color:#f92672">:</span> int
    JobTypes <span style="color:#f92672">:</span> Set<span style="color:#f92672">&lt;</span>JobType<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">with</span>
    <span style="color:#66d9ef">override</span> this.<span style="color:#a6e22e">ToString</span> () <span style="color:#f92672">=</span>
        <span style="color:#f92672">$</span><span style="color:#e6db74">&#34;Machine_{this.Id}&#34;</span>
</code></pre></div><p>I like to override the <code>ToString</code> method because the <code>ConstraintBuilder</code> and <code>DecisionBuilder</code> in <code>Flips</code> use <code>ToString</code> for the naming of constraints and decisions. <code>JobType</code> is a straightforward Discriminated Union with three different cases <code>A</code>, <code>B</code>, and <code>C</code>. <code>Job</code> has an <code>Id</code> field for identifying a particular <code>Job</code>, a <code>JobType</code> which describes the type of job that it is, and the <code>Size</code>.</p>
<p>The <code>Machine</code> type has an <code>Id</code> field and a <code>JobTypes</code> field. The <code>JobTypes</code> field is a <code>Set</code> of <code>JobType</code>. This represents the jobs the <code>Machine</code> can process.</p>
<p>We now want to setup some data for us to be able to play with. These will be the parameters which will help us generate random data for us to work with.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// Set of JobTypes for iterating over and sampling from
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> jobTypes <span style="color:#f92672">=</span> 
    <span style="color:#f92672">[|</span>
        JobType.A
        JobType.B
        JobType.C
    <span style="color:#f92672">|]</span>

<span style="color:#75715e">// Some theoretical JobTypeSets to be used in generating
</span><span style="color:#75715e">// random Machines
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> jobTypeSets <span style="color:#f92672">=</span>
    <span style="color:#f92672">[|</span>
        Set jobTypes
        Set jobTypes<span style="color:#f92672">.[</span>1<span style="color:#f92672">..]</span>
        Set jobTypes<span style="color:#f92672">.[..</span>1<span style="color:#f92672">]</span>
    <span style="color:#f92672">|]</span>

<span style="color:#75715e">// Setting up parameters for the example
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> rng <span style="color:#f92672">=</span> System.Random<span style="color:#f92672">(</span>123<span style="color:#f92672">)</span>
<span style="color:#66d9ef">let</span> numberOfJobs <span style="color:#f92672">=</span> 20
<span style="color:#66d9ef">let</span> numberOfMachines <span style="color:#f92672">=</span> 5
<span style="color:#66d9ef">let</span> minJobSize <span style="color:#f92672">=</span> 1
<span style="color:#66d9ef">let</span> maxJobSize <span style="color:#f92672">=</span> 3
<span style="color:#66d9ef">let</span> maxWorkDifference <span style="color:#f92672">=</span> 2<span style="color:#f92672">.</span>0
</code></pre></div><p><code>jobTypes</code> is an <code>Array</code> which holds each of the possible <code>JobType</code> cases. We will use this to create random jobs. The <code>jobTypeSets</code> value is an <code>Array</code> of <code>Set&lt;JobType&gt;</code>. These are the possible values for the <code>JobTypes</code> field of <code>Machine</code> that we will use for generating random machines. For this example, we will have 20 jobs and 5 machines to assign them to. <code>minJobSize</code> will control how small a job can be and <code>maxJobSize</code> will determine how large. The <code>maxWorkDifference</code> parameter will determine how different the loading of machines that we will allow.</p>
<p>We now create some convenience functions for generating random data. We will also add a function for looking up a key in a <code>Map</code> but returning a default value when the key is not present.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> randomJobSize <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> System.Random<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
    rng<span style="color:#f92672">.</span>Next<span style="color:#f92672">(</span>minJobSize<span style="color:#f92672">,</span> maxJobSize<span style="color:#f92672">)</span>
    <span style="color:#f92672">|&gt;</span> <span style="color:#66d9ef">float</span>

<span style="color:#66d9ef">let</span> randomJobType <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> System.Random<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
    jobTypes<span style="color:#f92672">.[</span>rng<span style="color:#f92672">.</span>Next<span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> jobTypes<span style="color:#f92672">.</span>Length<span style="color:#f92672">)]</span>

<span style="color:#66d9ef">let</span> randomJobTypeSet <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> System.Random<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
    jobTypeSets<span style="color:#f92672">.[</span>rng<span style="color:#f92672">.</span>Next<span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> jobTypeSets<span style="color:#f92672">.</span>Length<span style="color:#f92672">)]</span>

<span style="color:#66d9ef">module</span> Map <span style="color:#f92672">=</span>

    <span style="color:#75715e">// Useful when you want to look up a key in a Map but you want it to provide
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// a default value if the key is missing
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> tryFindDefault <span style="color:#f92672">(</span>key<span style="color:#f92672">:</span> <span style="color:#66d9ef">&#39;</span>a<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>defaultValue<span style="color:#f92672">:</span> <span style="color:#66d9ef">&#39;</span>v<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>m<span style="color:#f92672">:</span> Map<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">&#39;</span>a<span style="color:#f92672">,</span> <span style="color:#66d9ef">&#39;</span>v<span style="color:#f92672">&gt;)</span> <span style="color:#f92672">=</span>
        <span style="color:#66d9ef">match</span> Map.tryFind key m <span style="color:#66d9ef">with</span>
        <span style="color:#f92672">|</span> Some v <span style="color:#f92672">-&gt;</span> v
        <span style="color:#f92672">|</span> None <span style="color:#f92672">-&gt;</span> defaultValue
</code></pre></div><p>We can now generate a random set of jobs and machines to work with.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// Create some examples jobs
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> jobs <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span>1<span style="color:#f92672">..</span>numberOfJobs<span style="color:#f92672">]</span>
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> id <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span> 
        Id <span style="color:#f92672">=</span> id
        JobType <span style="color:#f92672">=</span> randomJobType rng
        Length <span style="color:#f92672">=</span> randomJobSize rng 
    <span style="color:#f92672">})</span>

<span style="color:#75715e">// Create some test machines
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> machines <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span>1<span style="color:#f92672">..</span>numberOfMachines<span style="color:#f92672">]</span>
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> id <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
        Id <span style="color:#f92672">=</span> id
        JobTypes <span style="color:#f92672">=</span> randomJobTypeSet rng
    <span style="color:#f92672">})</span>
</code></pre></div><h2 id="formulating-the-problem">Formulating the Problem<a hidden class="anchor" aria-hidden="true" href="#formulating-the-problem">#</a></h2>
<p>Now that we have some data to work with, we can get to formulating our model. Let&rsquo;s go ahead and open <code>Flips</code>. I love working with VS Code, Ionide, and <code>.fsx</code> files for this kind of exploration. The new <code>#r &quot;nuget: &lt;library name&gt;&quot;</code> syntax for using Nuget packages has been a game changer.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#f92672">#</span>r <span style="color:#e6db74">&#34;nuget: Flips&#34;</span>

<span style="color:#66d9ef">open</span> Flips
<span style="color:#66d9ef">open</span> Flips.Types
<span style="color:#66d9ef">open</span> Flips.SliceMap
</code></pre></div><p>We want to create a <code>Map</code> where they key is a <code>JobType</code> and the value is a list of <code>Job</code> that are of that type. This will make it easy for us to lookup the <code>Job</code>s of a given type.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// A Map from JobType to the Jobs which are of that type
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> jobsForJobType <span style="color:#f92672">=</span>
    jobs
    <span style="color:#f92672">|&gt;</span> List.groupBy <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> job <span style="color:#f92672">-&gt;</span> job<span style="color:#f92672">.</span>JobType<span style="color:#f92672">)</span>
    <span style="color:#f92672">|&gt;</span> Map
</code></pre></div><p>We now want to create a 1-dimensional <code>SliceMap</code> where the <code>'key</code> is a <code>Job</code> and the <code>'value</code> is the size of the job. This will make it easy for us to sum up how much work has been assigned to a <code>Machine</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// A SliceMap where the key is a Job and the value is the size of the Job
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> jobSizes <span style="color:#f92672">=</span>
    jobs
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> job <span style="color:#f92672">-&gt;</span> job<span style="color:#f92672">,</span> job<span style="color:#f92672">.</span>Size<span style="color:#f92672">)</span>
    <span style="color:#f92672">|&gt;</span> SMap
</code></pre></div><p>Now let&rsquo;s create the set of <code>Decision</code>s which will represent us assigning a <code>Job</code> to a <code>Machine</code>. We will store this in a 3-dimensional <code>SliceMap</code> keyed by the <code>Machine</code>, the <code>JobType</code>, and finally the <code>Job</code>. The reason we key by the <code>JobType</code> will become apparent later in the formulation. We will use a <code>Boolean</code> decision where <code>1.0</code> indicates that we are assigning the <code>Job</code> to a <code>Machine</code> and <code>0.0</code> indicates not.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// The Decisions which represent assigning a Job to a Machine
</span><span style="color:#75715e">// The JobType index allows us to slice along the job type
</span><span style="color:#75715e">// which is useful in some of the constraints
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> assignments <span style="color:#f92672">=</span>
    DecisionBuilder <span style="color:#e6db74">&#34;Assignment&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> machine <span style="color:#66d9ef">in</span> machines <span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">for</span> jobType <span style="color:#66d9ef">in</span> machine<span style="color:#f92672">.</span>JobTypes <span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">for</span> job <span style="color:#66d9ef">in</span> Map.tryFindDefault jobType [] jobsForJobType <span style="color:#f92672">-&gt;</span>
            Boolean
    <span style="color:#f92672">}</span> <span style="color:#f92672">|&gt;</span> SMap3
</code></pre></div><p>Now that we have these decisions which represent assigning a job to a machine, we can formulate our first and most obvious constraints. Each job must be assigned to one machine. For each job we say that the sum of <code>assignments</code> for a given <code>job</code> across all machines and all job-types must be <code>1.0</code>. This forces the solver to find a solution where each <code>job</code> is assigned once.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// Each job must be assigned
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> jobsAssignmentConstraints <span style="color:#f92672">=</span>
    ConstraintBuilder <span style="color:#e6db74">&#34;JobAssignment&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> job <span style="color:#66d9ef">in</span> jobs <span style="color:#f92672">-&gt;</span>
            sum assignments<span style="color:#f92672">.[</span>All<span style="color:#f92672">,</span> All<span style="color:#f92672">,</span> job<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> 1<span style="color:#f92672">.</span>0
    <span style="color:#f92672">}</span>
</code></pre></div><h2 id="constraint-or-objective">Constraint or Objective?<a hidden class="anchor" aria-hidden="true" href="#constraint-or-objective">#</a></h2>
<p>We now come to an interesting question. Our original problem statement said that we want to minimize the number of different job-types a machine must deal with. Ideally each machine only works on a single job-type. We also said that we want the machines evenly loaded. When I was chatting with my friend I dug into this point. Which one of these objectives is more important because we can&rsquo;t optimize for both? This is where a modeler needs to work with their client to help them understand what the most important thing is truly.</p>
<p>In our case, minimizing the different job-types for machines was the most important, so long as the machines were not too unevenly loaded. This means that the goal for even loading becomes a constraint and the objective remains the minimization of different job-types for machines. We will explore variations of this problem in future posts.</p>
<h2 id="controlling-the-difference-in-loading">Controlling the Difference in Loading<a hidden class="anchor" aria-hidden="true" href="#controlling-the-difference-in-loading">#</a></h2>
<p>Now that we have decided that even machine loading needs to be a constraint, we need to create some <code>Decision</code>s to control for it. We will create two <code>Decision</code>s. One will represent the value of the machine with the greatest loading and the other the machine with the least loading.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// A Decision which is meant to represent the MaxWork value across all Machines
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> maxWork <span style="color:#f92672">=</span> Decision.createContinuous <span style="color:#e6db74">&#34;MaxWork&#34;</span> 0<span style="color:#f92672">.</span>0 infinity
<span style="color:#75715e">// A Decision which is meant to represent the MinWork value across all Machines
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> minWork <span style="color:#f92672">=</span> Decision.createContinuous <span style="color:#e6db74">&#34;MinWork&#34;</span> 0<span style="color:#f92672">.</span>0 infinity
</code></pre></div><p>Now, we want to create a <code>Constraint</code> which states that the difference between these two values is not greater than the maximum allowed difference.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// We constrain the difference between the most heavily loaded machine
</span><span style="color:#75715e">// and the least loaded
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> maxWorkDifferenceConstraint <span style="color:#f92672">=</span>
    Constraint.create <span style="color:#e6db74">&#34;MaxWorkDifferent&#34;</span> <span style="color:#f92672">(</span>maxWork <span style="color:#f92672">-</span> minWork <span style="color:#f92672">&lt;==</span> maxWorkDifference<span style="color:#f92672">)</span>
</code></pre></div><p>Okay, that&rsquo;s great but will it do anything? Right now, there is nothing that forces the <code>maxWork</code> decision to be equal to the loading of the most heavily loaded machine. There&rsquo;s also nothing which forces <code>minWork</code> to be equal to the loading of the most lightly loaded machine. The solver could set the values to <code>0.0</code> and be done with it. We need to create some constraints which will force <code>maxWork</code> and <code>minWork</code> to take on the loading of the most heavily and most lightly loaded machines.</p>
<p>Let&rsquo;s create some constraints which state that the value of the <code>maxWork</code> decision must be greater than or equal to the loading of all the machines. This will force it to be a value above or equal to the maximum loading.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// The maxWork Decision must be greater or equal to all of the total work
</span><span style="color:#75715e">// for each Machine
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> maxWorkConstraints <span style="color:#f92672">=</span>
    ConstraintBuilder <span style="color:#e6db74">&#34;MaxWork&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> machine <span style="color:#66d9ef">in</span> machines <span style="color:#f92672">-&gt;</span>
            maxWork <span style="color:#f92672">&gt;==</span> sum <span style="color:#f92672">(</span>assignments<span style="color:#f92672">.[</span>machine<span style="color:#f92672">,</span> All<span style="color:#f92672">,</span> All<span style="color:#f92672">]</span> <span style="color:#f92672">.*</span> jobSizes<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>We do a similar thing for the <code>minWork</code> decision. In this case we will say that <code>minWork</code> must be less than or equal to all the loadings of the machines.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// The minWork Decision must be less or equal to all of the total work
</span><span style="color:#75715e">// for each Machine
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> minWorkConstraints <span style="color:#f92672">=</span>
    ConstraintBuilder <span style="color:#e6db74">&#34;MinWork&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> machine <span style="color:#66d9ef">in</span> machines <span style="color:#f92672">-&gt;</span>
            minWork <span style="color:#f92672">&lt;==</span> sum <span style="color:#f92672">(</span>assignments<span style="color:#f92672">.[</span>machine<span style="color:#f92672">,</span> All<span style="color:#f92672">,</span> All<span style="color:#f92672">]</span> <span style="color:#f92672">.*</span> jobSizes<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p><code>maxWorkConstraints</code> and <code>minWorkConstraints</code> will force <code>maxWork</code> and <code>minWork</code> to take on the values of the most heavily and lightly loaded machines respectively. <code>maxWorkDifferenceConstraint</code> states that the difference between <code>maxWork</code> and <code>minWork</code> must be within the permissable bounds. All together these constraints will prevent the solver from distributing jobs across machines unevenly.</p>
<h2 id="minimizing-the-job-types-for-machines">Minimizing the Job-Types for Machines<a hidden class="anchor" aria-hidden="true" href="#minimizing-the-job-types-for-machines">#</a></h2>
<p>We now need to quantify how many different job-types are being assigned to machines. To do this, we will create a set of <code>Boolean</code> decisions which will indicate whether we have decided to assign a job of a given job-type to a machine. We will store these in a 2-dimensional <code>SliceMap</code> where the keys are the <code>Machine</code> and the <code>JobType</code>. <code>1</code> will represent that we have decided to assign a given <code>JobType</code> to a <code>Machine</code>. <code>0</code> will indicate that we did not. I like to think of this as &ldquo;turning on&rdquo; or &ldquo;turning off&rdquo; the job-type for the machine. We will call these decisions the <code>setups</code> decisions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// A Decision which indicates whether we setup a given Machine for a 
</span><span style="color:#75715e">// JobType at any point
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> setups <span style="color:#f92672">=</span>
    DecisionBuilder <span style="color:#e6db74">&#34;Setups&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> machine <span style="color:#66d9ef">in</span> machines <span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">for</span> jobType <span style="color:#66d9ef">in</span> jobTypes <span style="color:#f92672">-&gt;</span>
            Boolean
    <span style="color:#f92672">}</span> <span style="color:#f92672">|&gt;</span> SMap2
</code></pre></div><p>We now want to create some constraints which will force the solver to turn on the decision to allow the assigning of a job-type to a machine. We will do this by saying that the sum of jobs of a given job-type must be less than or equal to our decision to assign that job-type to the machine multiplied by a large number. This will force the solver to &ldquo;turn on&rdquo; the job-type for the machine. In our case the &ldquo;large number&rdquo; will be the total number of jobs.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// We must turn the setups value for a given Machine and JobType to 1
</span><span style="color:#75715e">// if we assign a Job of the given JobType to the Machine
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> setupConstraints <span style="color:#f92672">=</span>
    ConstraintBuilder <span style="color:#e6db74">&#34;SetupRequired&#34;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> machine <span style="color:#66d9ef">in</span> machines <span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">for</span> jobType <span style="color:#66d9ef">in</span> jobTypes <span style="color:#f92672">-&gt;</span>
            sum <span style="color:#f92672">(</span>assignments<span style="color:#f92672">.[</span>machine<span style="color:#f92672">,</span> jobType<span style="color:#f92672">,</span> All<span style="color:#f92672">])</span> <span style="color:#f92672">&lt;==</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">float</span> numberOfJobs<span style="color:#f92672">)</span> <span style="color:#f92672">*</span> setups<span style="color:#f92672">.[</span>machine<span style="color:#f92672">,</span> jobType<span style="color:#f92672">]</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>We can now create an expression which represents the number of different job-types that are assigned to machines.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// An expression which is the sum of the Setups that will need to be performed
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> numberSetupsExpression <span style="color:#f92672">=</span> sum setups
</code></pre></div><p>We use this expression to create our objective of minimizing the number of different job-types assigned to a machine.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// We want to minimize the number of setups
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> minSetupsObjective <span style="color:#f92672">=</span> Objective.create <span style="color:#e6db74">&#34;MinSetups&#34;</span> Minimize numberSetupsExpression
</code></pre></div><p>We can now compose our model from the parts that we have created.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// Compose the model
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> model <span style="color:#f92672">=</span>
    Model.create minSetupsObjective
    <span style="color:#f92672">|&gt;</span> Model.addConstraints jobsAssignmentConstraints
    <span style="color:#f92672">|&gt;</span> Model.addConstraints maxWorkConstraints
    <span style="color:#f92672">|&gt;</span> Model.addConstraints minWorkConstraints
    <span style="color:#f92672">|&gt;</span> Model.addConstraint maxWorkDifferenceConstraint
    <span style="color:#f92672">|&gt;</span> Model.addConstraints setupConstraints
</code></pre></div><p>We now ask the solver to find us a solution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// Give the solver plenty of time to find a solution
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> settings <span style="color:#f92672">=</span> <span style="color:#f92672">{</span> Settings.basic <span style="color:#66d9ef">with</span> MaxDuration <span style="color:#f92672">=</span> 60_000L <span style="color:#f92672">}</span>

<span style="color:#66d9ef">let</span> result <span style="color:#f92672">=</span> Solver.solve settings model
</code></pre></div><p>If you want to see the code that prints out the results you can check it out <a href="https://github.com/matthewcrews/modelmondays/blob/260d21184df7f5803a4c6a72ba13e8b61db4962d/2021-01-22-MachineAllocation/2021-01-22-MachineAllocation.fsx#L195">here</a>. This is the solution the solver found.</p>
<pre><code class="language-terminal" data-lang="terminal">Assignments:
Machine: 1
        Job: 4
        Job: 7
        Job: 8
        Job: 11
Machine: 2
        Job: 16
        Job: 18
        Job: 20
Machine: 3
        Job: 1
        Job: 3
        Job: 6
        Job: 12
        Job: 17
        Job: 19
Machine: 4
        Job: 2
        Job: 13
        Job: 14
Machine: 5
        Job: 5
        Job: 9
        Job: 10
        Job: 15

Machine Loading:
Machine: 1 | Total Load: 5
Machine: 2 | Total Load: 5
Machine: 3 | Total Load: 7
Machine: 4 | Total Load: 6
Machine: 5 | Total Load: 6

Max Diffence In Loading: 2
</code></pre><h2 id="next-steps">Next Steps<a hidden class="anchor" aria-hidden="true" href="#next-steps">#</a></h2>
<p>We&rsquo;ve only begone to explore this model. There are quite a few variations and nuances that I will dive into in the posts to come. In the future we will discuss adding machine capacity and dealing with infeasible models. We will also explore adding restrictions on just how much of a job-type can be assigned to a given machine. Some job-types cause more wear and therefore we do not want too much assigned to a single machine. We will also look at needing to re-plan part way through the day and look at scheduling over a longer time horizon.</p>
<p>These types of scheduling problems are common and therefore it&rsquo;s valuable for us to explore how we can play and tweak with this model to make it suit our needs. Feel free to reach out with questions and ideas for modeling challenges in the future!</p>

</div>
  <footer class="post-footer">



<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Scheduling Jobs for Maximum Efficiency - Part 1 on twitter"
        href="https://twitter.com/intent/tweet/?text=Scheduling%20Jobs%20for%20Maximum%20Efficiency%20-%20Part%201&amp;url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2021%2f01%2f2021-01-25%2f&amp;hashtags=">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Scheduling Jobs for Maximum Efficiency - Part 1 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2021%2f01%2f2021-01-25%2f&amp;title=Scheduling%20Jobs%20for%20Maximum%20Efficiency%20-%20Part%201&amp;summary=Scheduling%20Jobs%20for%20Maximum%20Efficiency%20-%20Part%201&amp;source=https%3a%2f%2fmatthewcrews.com%2fblog%2f2021%2f01%2f2021-01-25%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Scheduling Jobs for Maximum Efficiency - Part 1 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2021%2f01%2f2021-01-25%2f&title=Scheduling%20Jobs%20for%20Maximum%20Efficiency%20-%20Part%201">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Scheduling Jobs for Maximum Efficiency - Part 1 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmatthewcrews.com%2fblog%2f2021%2f01%2f2021-01-25%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Scheduling Jobs for Maximum Efficiency - Part 1 on whatsapp"
        href="https://api.whatsapp.com/send?text=Scheduling%20Jobs%20for%20Maximum%20Efficiency%20-%20Part%201%20-%20https%3a%2f%2fmatthewcrews.com%2fblog%2f2021%2f01%2f2021-01-25%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Scheduling Jobs for Maximum Efficiency - Part 1 on telegram"
        href="https://telegram.me/share/url?text=Scheduling%20Jobs%20for%20Maximum%20Efficiency%20-%20Part%201&amp;url=https%3a%2f%2fmatthewcrews.com%2fblog%2f2021%2f01%2f2021-01-25%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2021 <a href="https://matthewcrews.com">Matthew Crews</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>



<script defer src="/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js" integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.replaceState(null, null, `#${id}`);
            }
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
    };
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
</body>

</html>
