<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 3 - Matthew Crews</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/favicon-32x32.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

  
  
  
  <link rel="stylesheet" href="/css/style.min.3940494e396e00ba1cd5c589c5ff2ee8b5b9c03100b6fff6944d59e8f5cc2e56.css">
  

  

  
    
    <meta property="og:title" content="Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 3"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="/blog/2021/01/2020-01-01/"/>
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@zerostaticio"/>
    <meta name="twitter:creator" content="@zerostaticio"/>
  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-services">
      <a href="/services/">
        <span>Services</span>
      </a>
    </li>
    
    <li class="menu-item-blog">
      <a href="/blog/">
        <span>Blog</span>
      </a>
    </li>
    
    <li class="menu-item-about">
      <a href="/about/">
        <span>About</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="/"><img height=36px alt="Serif - A Hugo Business Theme" src="/images/logo/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="/"><img height=36px alt="Serif - A Hugo Business Theme" src="/images/logo/logo.png" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    
    
    <li class="menu-item-services ">
      <a href="/services/">
        
        <span>Services</span>
      </a>
    </li>
    
    
    
    <li class="menu-item-blog ">
      <a href="/blog/">
        
        <span>Blog</span>
      </a>
    </li>
    
    
    
    <li class="menu-item-about ">
      <a href="/about/">
        
        <span>About</span>
      </a>
    </li>
    
  </ul>
</div>

    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button" aria-label="Mobile Menu">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>

    
<div class="container pb-6 pt-6 pt-md-10 pb-md-10">
  <div class="row justify-content-start">
    <div class="col-12 col-md-8">
      <h1 class="title">Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 3</h1>
      <div class="content"><p>In the previous two posts in this series we introduced the Food Cart Problem. We want a plan for stocking our Food Cart which will maximizes our revenue. In the <a href="/blog/2020/12/2020-12-14/">first post</a> we discussed the foods that we can stock and the restrictions we are operating under. We introduced a simple heuristic for stocking the food cart and created a simulation in order to validate what our expected revenue is.</p>
<p>In the <a href="/blog/2020/12/2020-12-21/">second post</a> we formulated a Mathematical Planning model to create a plan to maximize our expected revenue. We validated that the plan found with Mathematical Planning is superior to the simple heuristic in the first post through simulations and statistical tests.</p>
<p>In this final post of the series, we will create a simple Machine Learning model to make predictions of expected demand using the weather conditions as predictors. We will combine the tools of Mathematical Planning and Machine Learning to create an even more profitable algorithm for stocking the food cart.</p>
<blockquote>
<p><strong>Note:</strong> To see all the code for this post, go <a href="https://github.com/matthewcrews/modelmondays/blob/main/FoodCartSeries/FoodCart-Part3.fsx">here</a></p>
</blockquote>
<h2 id="generating-test-data">Generating Test Data</h2>
<p>Since this problem is a hypothetical, we need to generate data to train a Machine Learning model on. The demand for food will be modeled using a <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson Distribution</a> but the mean of the demand, the $\lambda$, depend on the weather. We are going to generate data that follows a simple model.</p>
<p>$$
\begin{align}
\text{Demand Mean} = \ &amp;\text{Baseline Demand} \ + \\
&amp;\text{Temperature Coefficient} \times \text{temperature} \ + \\
&amp;\text{Condition Offset}
\end{align}
$$</p>
<p>Each food will have a baseline amount of demand, Baseline Demand. The demand for the food will go up or down depending on the temperature. The weather condition (Sunny, Cloudy, Rainy) will also bump the demand up or down in a stepwise manner. We will generate several months’ worth of weather conditions and then use them to generate our historical demand data.</p>
<p>We want to make our code clear and maintainable so we create a domain model. Let&rsquo;s create types to describe a day, temperature, conditions, and weather.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Day</span> <span style="color:#f92672">=</span> Day <span style="color:#66d9ef">of</span> int

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Temperature</span> <span style="color:#f92672">=</span> Temperature <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">float</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Condition</span> <span style="color:#f92672">=</span>
    <span style="color:#f92672">|</span> Sunny
    <span style="color:#f92672">|</span> Cloudy
    <span style="color:#f92672">|</span> Rainy

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Weather</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    Condition <span style="color:#f92672">:</span> Condition
    Temperature <span style="color:#f92672">:</span> Temperature
<span style="color:#f92672">}</span>
</code></pre></div><p>Now we can create the type which holds the parameters for our demand model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DemandModelParameters</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    BaselineDemand <span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>
    TemperatureCoefficient <span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span>
    ConditionOffsets <span style="color:#f92672">:</span> Map<span style="color:#f92672">&lt;</span>Condition<span style="color:#f92672">,</span> <span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Our model will take the <code>Weather</code> as an input and simulate a random <code>Demand</code> based on the statistical model we just proposed. Let&rsquo;s create a type which describes this simulation result.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#f92672">[&lt;</span>Measure<span style="color:#f92672">&gt;]</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">serving</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Demand</span> <span style="color:#f92672">=</span> Demand <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">float</span><span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DemandSimulationResult</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    Day <span style="color:#f92672">:</span> Day
    Weather <span style="color:#f92672">:</span> Weather
    Demand <span style="color:#f92672">:</span> Demand
<span style="color:#f92672">}</span>
</code></pre></div><p>Now we can write a function which takes the <code>DemandModelParameters</code>, <code>Weather</code> and gives us a random <code>Demand</code> that follows our model. In statistics this is often called &ldquo;sampling from the distribution&rdquo; so we will call our function <code>sample</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">module</span> Demand <span style="color:#f92672">=</span>

    <span style="color:#66d9ef">let</span> sample <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> Random<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>parameters<span style="color:#f92672">:</span> DemandModelParameters<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>weather<span style="color:#f92672">:</span> Weather<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
        <span style="color:#66d9ef">let</span> <span style="color:#f92672">(</span>Temperature temperature<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> weather<span style="color:#f92672">.</span>Temperature
        <span style="color:#66d9ef">let</span> lambda <span style="color:#f92672">=</span> parameters<span style="color:#f92672">.</span>BaselineDemand <span style="color:#f92672">+</span> 
                     temperature <span style="color:#f92672">*</span> parameters<span style="color:#f92672">.</span>TemperatureCoefficient <span style="color:#f92672">+</span>
                     parameters<span style="color:#f92672">.</span>ConditionOffsets<span style="color:#f92672">.[</span>weather<span style="color:#f92672">.</span>Condition<span style="color:#f92672">]</span>
        <span style="color:#66d9ef">let</span> result <span style="color:#f92672">=</span> Poisson.Sample <span style="color:#f92672">(</span>rng<span style="color:#f92672">,</span> lambda<span style="color:#f92672">)</span>
        Demand <span style="color:#f92672">(</span><span style="color:#66d9ef">float</span> result <span style="color:#f92672">*</span> 1<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;)</span>
</code></pre></div><p>The <code>Poisson.Sample</code> function returns an <code>int</code> which isn&rsquo;t what we will want for training our Machine Learning model, so we go ahead and turn it into a <code>float</code> and attach Units of Measure. Units of Measure are incredibly valuable in tracking what numbers mean but they can add a little bit of boilerplate in some cases. I find it worth the clarity they bring.</p>
<p>We want to add a couple more functions for generating random <code>Temperature</code>, <code>Condition</code> and <code>Weather</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">module</span> Condition <span style="color:#f92672">=</span>

    <span style="color:#66d9ef">let</span> private conditions <span style="color:#f92672">=</span> 
        <span style="color:#f92672">[</span>
            0<span style="color:#f92672">,</span> Sunny
            1<span style="color:#f92672">,</span> Cloudy
            2<span style="color:#f92672">,</span> Rainy
        <span style="color:#f92672">]</span> <span style="color:#f92672">|&gt;</span> Map

    <span style="color:#66d9ef">let</span> sample <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> Random<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
        conditions<span style="color:#f92672">.[</span>rng<span style="color:#f92672">.</span>Next<span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> 2<span style="color:#f92672">)]</span>


<span style="color:#66d9ef">module</span> Temperature <span style="color:#f92672">=</span>

    <span style="color:#66d9ef">let</span> sample <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> Random<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>Temperature minTemperature<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>Temperature maxTemperature<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
        rng<span style="color:#f92672">.</span>NextDouble() <span style="color:#f92672">*</span> <span style="color:#f92672">(</span>maxTemperature <span style="color:#f92672">-</span> minTemperature<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> minTemperature
        <span style="color:#f92672">|&gt;</span> Math.Round
        <span style="color:#f92672">|&gt;</span> Temperature


<span style="color:#66d9ef">module</span> Weather <span style="color:#f92672">=</span>

    <span style="color:#66d9ef">let</span> sample <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> Random<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>minTemperature<span style="color:#f92672">:</span> Temperature<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>maxTemperature<span style="color:#f92672">:</span> Temperature<span style="color:#f92672">)</span> <span style="color:#f92672">:</span> Weather <span style="color:#f92672">=</span>
        <span style="color:#66d9ef">let</span> condition <span style="color:#f92672">=</span> Condition.sample rng
        <span style="color:#66d9ef">let</span> temperature <span style="color:#f92672">=</span> Temperature.sample rng minTemperature maxTemperature
        <span style="color:#f92672">{</span>
            Condition <span style="color:#f92672">=</span> condition
            Temperature <span style="color:#f92672">=</span> temperature
        <span style="color:#f92672">}</span>
</code></pre></div><p>Well, this is great. We now have a way of generating data for which we can train a ML model on. Let&rsquo;s do this for Burgers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// Parameters for generating samples data
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> burgerParameters <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    BaselineDemand <span style="color:#f92672">=</span> 337<span style="color:#f92672">.</span>5
    TemperatureCoefficient <span style="color:#f92672">=</span> 3<span style="color:#f92672">.</span>5
    ConditionOffsets <span style="color:#f92672">=</span> Map <span style="color:#f92672">[</span> Sunny<span style="color:#f92672">,</span> <span style="color:#f92672">-</span>30<span style="color:#f92672">.</span>0<span style="color:#f92672">;</span> Cloudy<span style="color:#f92672">,</span> 0<span style="color:#f92672">.</span>0<span style="color:#f92672">;</span> Rainy<span style="color:#f92672">,</span> 30<span style="color:#f92672">.</span>0 <span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">let</span> rng <span style="color:#f92672">=</span> System.Random<span style="color:#f92672">(</span>123<span style="color:#f92672">)</span>
<span style="color:#75715e">// Number of days for which to generate data
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> numberOfDays <span style="color:#f92672">=</span> 100
<span style="color:#66d9ef">let</span> minTemp <span style="color:#f92672">=</span> Temperature 40<span style="color:#f92672">.</span>0
<span style="color:#66d9ef">let</span> maxTemp <span style="color:#f92672">=</span> Temperature 110<span style="color:#f92672">.</span>0
<span style="color:#66d9ef">let</span> pastDays <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span>1<span style="color:#f92672">..</span>numberOfDays<span style="color:#f92672">]</span>
    <span style="color:#f92672">|&gt;</span> List.map Day

<span style="color:#66d9ef">let</span> pastWeather <span style="color:#f92672">=</span>
    pastDays
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> day <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{|</span> Day <span style="color:#f92672">=</span> day<span style="color:#f92672">;</span> Weather <span style="color:#f92672">=</span> Simulation.Weather.sample rng minTemp maxTemp <span style="color:#f92672">|})</span>
    
<span style="color:#66d9ef">let</span> burgerDemand <span style="color:#f92672">=</span>
    pastWeather
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{|</span> d <span style="color:#66d9ef">with</span> Demand <span style="color:#f92672">=</span> Simulation.Demand.sample rng burgerParameters d<span style="color:#f92672">.</span>Weather <span style="color:#f92672">|})</span>
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> DemandSimulationResult.create d<span style="color:#f92672">.</span>Day d<span style="color:#f92672">.</span>Weather d<span style="color:#f92672">.</span>Demand <span style="color:#f92672">)</span>
</code></pre></div><p>We have now simulated 100 days’ worth of Burger demand based on the weather for that day. We now want to use this data to train a Machine Learning model so that we can make predictions of Demand going forward and better optimize our inventory at the beginning of the day.</p>
<h2 id="training-a-machine-learning-model">Training a Machine Learning Model</h2>
<p>We will use <a href="https://dotnet.microsoft.com/apps/machinelearning-ai/ml-dotnet">ML.NET</a> to create a simple ML Model to predict demand. The ML.NET API can use many different data sources as inputs. For our case, we will save our historical weather and demand data to a local <code>.csv</code> file. I am not giong to show the boilerplate for saving the data but you can find it in the <a href="https://github.com/matthewcrews/modelmondays/blob/main/FoodCartSeries/FoodCart-Part3.fsx">full code example</a>.</p>
<p>The ML.NET API has you define types for your training data that it uses for parsing the input. In our case we will have delimited records in a <code>.csv</code> file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#f92672">[&lt;</span>CLIMutable<span style="color:#f92672">&gt;]</span>
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DemandData</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">[&lt;</span>LoadColumn<span style="color:#f92672">(</span>1<span style="color:#f92672">)&gt;]</span>
    Temperature <span style="color:#f92672">:</span> <span style="color:#66d9ef">single</span>
    <span style="color:#f92672">[&lt;</span>LoadColumn<span style="color:#f92672">(</span>2<span style="color:#f92672">)&gt;]</span>
    Condition <span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span>
    <span style="color:#f92672">[&lt;</span>LoadColumn<span style="color:#f92672">(</span>3<span style="color:#f92672">);</span> ColumnName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Label&#34;</span><span style="color:#f92672">)&gt;]</span>
    Demand <span style="color:#f92672">:</span> <span style="color:#66d9ef">single</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>The <code>[&lt;LoadColumn(n)&gt;]</code> attribute tells ML.NET which column in the source data corresponds to that field. Our saved data looks like this:</p>
<table>
<thead>
<tr>
<th>Day</th>
<th>Temperature</th>
<th>Condition</th>
<th>Demand</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>104</td>
<td>Cloudy</td>
<td>706</td>
</tr>
<tr>
<td>2</td>
<td>97</td>
<td>Cloudy</td>
<td>645</td>
</tr>
<tr>
<td>3</td>
<td>43</td>
<td>Cloudy</td>
<td>492</td>
</tr>
<tr>
<td>4</td>
<td>50</td>
<td>Sunny</td>
<td>457</td>
</tr>
</tbody>
</table>
<p>We don&rsquo;t need the data in the <code>Day</code> column so we are ignoring it. The <code>[&lt;ColumnName(&quot;Label&quot;)&gt;]</code> is what tells ML.NET the field that I am trying to predict. It will use the other fields as inputs to try to predict <code>Demand</code>. We want to create a function which takes an input file, trains a model, and then saves the model locally. ML.NET allows you to save trained models as <code>.zip</code> files. This makes it easy to load a pre-existing model to use in your code.</p>
<p>We will be working with several different types of files and I find it useful to create some simple types to represent that.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DataFile</span> <span style="color:#f92672">=</span> DataFile <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">string</span>
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ModelFile</span> <span style="color:#f92672">=</span> ModelFile <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">string</span>
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">OutputDirectory</span> <span style="color:#f92672">=</span> OutputDirectory <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">string</span>
</code></pre></div><p>A <code>DataFile</code> is a filepath to the <code>.csv</code> which holds our data. A <code>ModelFile</code> is the <code>.zip</code> which holds the persisted form of our ML model for predicting demand. The <code>OutputDirectory</code> is just a directory where we want to put data and models.</p>
<p>We can now put together a simple <code>train</code> function which will take our input data, train an ML model, and then save it for us to use later. We will also report the metrics from the training.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">open</span> Microsoft.ML
<span style="color:#66d9ef">open</span> Microsoft.ML.Data
<span style="color:#66d9ef">open</span> Types

<span style="color:#66d9ef">let</span> private reportMetrics <span style="color:#f92672">(</span>metrics<span style="color:#f92672">:</span> RegressionMetrics<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
    <span style="color:#75715e">// show the metrics
</span><span style="color:#75715e"></span>    printfn <span style="color:#e6db74">&#34;Model metrics:&#34;</span>
    printfn <span style="color:#e6db74">&#34;  RMSE:%f&#34;</span> metrics<span style="color:#f92672">.</span>RootMeanSquaredError
    printfn <span style="color:#e6db74">&#34;  MSE: %f&#34;</span> metrics<span style="color:#f92672">.</span>MeanSquaredError
    printfn <span style="color:#e6db74">&#34;  MAE: %f&#34;</span> metrics<span style="color:#f92672">.</span>MeanAbsoluteError

<span style="color:#66d9ef">let</span> train <span style="color:#f92672">(</span>OutputDirectory outputDir<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>modelName<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>inputFile<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
    <span style="color:#66d9ef">let</span> context <span style="color:#f92672">=</span> MLContext()
    <span style="color:#66d9ef">let</span> dataView <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>Data<span style="color:#f92672">.</span>LoadFromTextFile<span style="color:#f92672">&lt;</span>DemandData<span style="color:#f92672">&gt;</span> <span style="color:#f92672">(</span>inputFile<span style="color:#f92672">,</span> hasHeader <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> separatorChar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;,&#39;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">let</span> partitions <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>Data<span style="color:#f92672">.</span>TrainTestSplit<span style="color:#f92672">(</span>dataView<span style="color:#f92672">,</span> testFraction <span style="color:#f92672">=</span> 0<span style="color:#f92672">.</span>2<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">let</span> pipeline <span style="color:#f92672">=</span> 
        EstimatorChain()
            <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Transforms<span style="color:#f92672">.</span>Categorical<span style="color:#f92672">.</span>OneHotEncoding<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Condition&#34;</span><span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Transforms<span style="color:#f92672">.</span>NormalizeMeanVariance<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Temperature&#34;</span><span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Transforms<span style="color:#f92672">.</span>Concatenate<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Features&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Condition&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Temperature&#34;</span><span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Regression<span style="color:#f92672">.</span>Trainers<span style="color:#f92672">.</span>Sdca()<span style="color:#f92672">)</span>
    
    <span style="color:#66d9ef">let</span> model <span style="color:#f92672">=</span> partitions<span style="color:#f92672">.</span>TrainSet <span style="color:#f92672">|&gt;</span> pipeline<span style="color:#f92672">.</span>Fit
    <span style="color:#66d9ef">let</span> metrics <span style="color:#f92672">=</span> partitions<span style="color:#f92672">.</span>TestSet <span style="color:#f92672">|&gt;</span> model<span style="color:#f92672">.</span>Transform <span style="color:#f92672">|&gt;</span> context<span style="color:#f92672">.</span>Regression<span style="color:#f92672">.</span>Evaluate
    reportMetrics metrics <span style="color:#f92672">|&gt;</span> ignore

    System.IO.Directory.CreateDirectory outputDir <span style="color:#f92672">|&gt;</span> ignore
    <span style="color:#66d9ef">let</span> outputFile <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#e6db74">&#34;{outputDir}/%O{modelName}.zip&#34;</span>
    context<span style="color:#f92672">.</span>Model<span style="color:#f92672">.</span>Save <span style="color:#f92672">(</span>model<span style="color:#f92672">,</span> dataView<span style="color:#f92672">.</span>Schema<span style="color:#f92672">,</span> outputFile<span style="color:#f92672">)</span>

    ModelFile outputFile
</code></pre></div><p>The part where we define the shape of our model is in the definition of <code>pipeline</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> pipeline <span style="color:#f92672">=</span> 
    EstimatorChain()
        <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Transforms<span style="color:#f92672">.</span>Categorical<span style="color:#f92672">.</span>OneHotEncoding<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Condition&#34;</span><span style="color:#f92672">))</span>
        <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Transforms<span style="color:#f92672">.</span>NormalizeMeanVariance<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Temperature&#34;</span><span style="color:#f92672">))</span>
        <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Transforms<span style="color:#f92672">.</span>Concatenate<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Features&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Condition&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Temperature&#34;</span><span style="color:#f92672">))</span>
        <span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Regression<span style="color:#f92672">.</span>Trainers<span style="color:#f92672">.</span>Sdca()<span style="color:#f92672">)</span>
</code></pre></div><p>We know that the <code>Condition</code> data is categorical so we need to encode it in a way that the training code understands. <a href="https://en.wikipedia.org/wiki/One-hot">One-hot Encoding</a> represents categories as a set of Boolean values. It&rsquo;s a similar concept to binary encoding of numbers but they are not the same, so don&rsquo;t mix them up!</p>
<p>We then take the step to normalize the mean and variance of the <code>Temperature</code> data. ML training really likes to have the data lie between -1.0 and 1.0. This protects against features appearing more important than they are. Our temperature values are between 40.0 and 110.0 which could cause a problem for the training code.</p>
<p>We now combine our One-hot encoded <code>Condition</code> column with the normalized <code>Temperature</code> data using <code>Transforms.Concatenate</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Transforms<span style="color:#f92672">.</span>Concatenate<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Features&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Condition&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Temperature&#34;</span><span style="color:#f92672">))</span>
</code></pre></div><p>What this does is create a new column of data called &ldquo;Features&rdquo;. ML.NET wants there to be a &ldquo;Features&rdquo; column for it to use as the input to the training algorithm. &ldquo;Features&rdquo; is the default name for the input data of a training model. It can be configured but I am going with the default.</p>
<p>The final part of the definition for our <code>pipeline</code> is the type of model we want it to fit. In our case we are performing regression since we are trying to predict continuous data, <code>Demand</code> in this case. ML.NET has a large number of possible algorithms. In our case we are using the Stochastic Dual Coordinate Ascent (SDCA) method to fit a linear model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#f92672">.</span>Append<span style="color:#f92672">(</span>context<span style="color:#f92672">.</span>Regression<span style="color:#f92672">.</span>Trainers<span style="color:#f92672">.</span>Sdca()<span style="color:#f92672">)</span>
</code></pre></div><p>We now train the model using the training data set and evaluate the metrics with the test data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> model <span style="color:#f92672">=</span> partitions<span style="color:#f92672">.</span>TrainSet <span style="color:#f92672">|&gt;</span> pipeline<span style="color:#f92672">.</span>Fit
<span style="color:#66d9ef">let</span> metrics <span style="color:#f92672">=</span> partitions<span style="color:#f92672">.</span>TestSet <span style="color:#f92672">|&gt;</span> model<span style="color:#f92672">.</span>Transform <span style="color:#f92672">|&gt;</span> context<span style="color:#f92672">.</span>Regression<span style="color:#f92672">.</span>Evaluate
reportMetrics metrics <span style="color:#f92672">|&gt;</span> ignore
</code></pre></div><p>If we run our Burger data through we will see the following metrics reported</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> burgerDemandModelFile <span style="color:#f92672">=</span>
    Training.train outputDirectory <span style="color:#e6db74">&#34;BurgerDemandModel&#34;</span> burgerDemandDataFile

<span style="color:#f92672">&gt;</span> Model metrics<span style="color:#f92672">:</span>
    RMSE<span style="color:#f92672">:</span>19<span style="color:#f92672">.</span>713698
    MSE<span style="color:#f92672">:</span> 388<span style="color:#f92672">.</span>629880
    MAE<span style="color:#f92672">:</span> 13<span style="color:#f92672">.</span>099727
</code></pre></div><p><code>MAE</code> stands for <a href="https://en.wikipedia.org/wiki/Mean_absolute_error">Mean Absolute Error</a>. It is the average of how far our prediction is off from the correct value. <code>MSE</code> stands for <a href="https://en.wikipedia.org/wiki/Mean_squared_error">Mean Squared Error</a> and is the average of the square of the error. <code>RMSE</code> is the <a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation">Root Mean Square Error</a> which is the square root of <code>MSE</code>. Which one of these is the most important? It depends. When I&rsquo;m working with someone, I want to understand the implications of a bad prediction. That would guide which metrics I tune for.</p>
<p>There are many great resources out there on Machine Learning, so I will not go in depth here. For now, let&rsquo;s say that our model looks good enough and see how it performs when we combine it with our Mathematical Planning model.</p>
<h2 id="mp--ml--">MP + ML = $$$</h2>
<p>To evaluate how our new predictor performs, we will combine it with our Mathematical Planning model. Let&rsquo;s simulate 30 days into the future and compare the three approaches: Simple Heuristic, Mathematical Planning, Mathematical Planning + Machine Learning.</p>
<p>We generate 30 days into the future. For each day we sample from the possible weather conditions. We then take the <code>Weather</code> for each day and generate a sample of the demand for each food from our underlying statistical model. We store the result in a <code>Map&lt;Food, Demand&gt;</code> to simplify some of our later code.</p>
<p>To make our code cleaner we are going to add a new function to our <code>Simulation</code> module for the demand for all the foods in each day.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">module</span> DayDemand <span style="color:#f92672">=</span>

    <span style="color:#66d9ef">let</span> sample <span style="color:#f92672">(</span>rng<span style="color:#f92672">:</span> Random<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>parameters<span style="color:#f92672">:</span> Map<span style="color:#f92672">&lt;</span>Food<span style="color:#f92672">,</span> DemandModelParameters<span style="color:#f92672">&gt;)</span> <span style="color:#f92672">(</span>weather<span style="color:#f92672">:</span> Weather<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>

        parameters
        <span style="color:#f92672">|&gt;</span> Map.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> food demandParameters <span style="color:#f92672">-&gt;</span> Demand.sample rng demandParameters weather<span style="color:#f92672">)</span>
</code></pre></div><p>It&rsquo;s a small thing, but I have rarely regretted making my code clean and simple. Now we will generate 30 days’ worth of weather data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> numberFutureDays <span style="color:#f92672">=</span> 30

<span style="color:#75715e">// Let&#39;s create some future data that we will evaluate our different techniques against
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> futureDays <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span>1<span style="color:#f92672">..</span>numberFutureDays<span style="color:#f92672">]</span>
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{|</span> Day <span style="color:#f92672">=</span> Day d<span style="color:#f92672">;</span> Weather <span style="color:#f92672">=</span> Simulation.Weather.sample rng minTemp maxTemp <span style="color:#f92672">|})</span>
</code></pre></div><p>With 30 days’ worth of future weather data, we will now generate theoretical demand on those days. We are “cheating” in that we have control of the generation of demand data. In real world scenarios there are some additional complexities that need to be dealt with. My desire is to show the concepts. Future posts can deal with the idiosyncrasies. We now generate the demand that would be observed on those days.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#75715e">// Let&#39;s create some future data that we will evaluate our different techniques against
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> futureDays <span style="color:#f92672">=</span>
    futureWeather
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{|</span> d <span style="color:#66d9ef">with</span> FoodDemand <span style="color:#f92672">=</span> Simulation.DayDemand.sample rng foodParameters d<span style="color:#f92672">.</span>Weather <span style="color:#f92672">|})</span>
</code></pre></div><p>We now have a list of days where we have the weather on that day and the demand. We can now calculate what our revenue would have been using the simple heuristic from the first blog post. We create a function which takes the planned inventory and the demand on a day to calculate the revenue.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">module</span> RevenueModel <span style="color:#f92672">=</span>

    <span style="color:#66d9ef">open</span> Types

    <span style="color:#66d9ef">let</span> evaluate <span style="color:#f92672">(</span>revenuePerServing<span style="color:#f92672">:</span> Map<span style="color:#f92672">&lt;</span>Food<span style="color:#f92672">,</span> RevenuePerServing<span style="color:#f92672">&gt;)</span> <span style="color:#f92672">(</span>inventoryPlan<span style="color:#f92672">:</span> Map<span style="color:#f92672">&lt;</span>Food<span style="color:#f92672">,</span> Inventory<span style="color:#f92672">&gt;)</span> <span style="color:#f92672">(</span>demand<span style="color:#f92672">:</span> Map<span style="color:#f92672">&lt;</span>Food<span style="color:#f92672">,</span> Demand<span style="color:#f92672">&gt;)</span> <span style="color:#f92672">=</span>
        inventoryPlan
        <span style="color:#f92672">|&gt;</span> Map.toSeq
        <span style="color:#f92672">|&gt;</span> Seq.sumBy <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> <span style="color:#f92672">(</span>food<span style="color:#f92672">,</span> inventory<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> revenuePerServing<span style="color:#f92672">.[</span>food<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> <span style="color:#f92672">(</span>Sales.calculate inventory demand<span style="color:#f92672">.[</span>food<span style="color:#f92672">]))</span>
</code></pre></div><p>The <code>RevenueModel.evaluate</code> function calculates what the revenue would have been on a day given the inventory plan that was used and the demand that was realized. We now use our simple heuristic plan for each of the future 30 days to see what our total revenue would have been.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> simpleHueristicPlan <span style="color:#f92672">=</span>
    Map <span style="color:#f92672">[</span>
        Burger<span style="color:#f92672">,</span> Inventory 0<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;</span>
        Pizza<span style="color:#f92672">,</span> Inventory 900<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;</span>
        Taco<span style="color:#f92672">,</span> Inventory 466<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">]</span>

<span style="color:#66d9ef">let</span> simpleHeuristicRevenue <span style="color:#f92672">=</span>
    futureDays
    <span style="color:#f92672">|&gt;</span> List.sumBy <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> RevenueModel.evaluate revenuePerServing simpleHueristicPlan d<span style="color:#f92672">.</span>FoodDemand<span style="color:#f92672">)</span>
</code></pre></div><p><code>simpleHeuristicRevenue</code> comes to $62,247.20. This will be our baseline. We now use the inventory plan we found using Mathematical Planning and find the revenue we would achieve.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> optimizedPlan <span style="color:#f92672">=</span>
    Map <span style="color:#f92672">[</span>
        Burger<span style="color:#f92672">,</span> Inventory 572<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;</span>
        Pizza<span style="color:#f92672">,</span> Inventory 355<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;</span>
        Taco<span style="color:#f92672">,</span> Inventory 669<span style="color:#f92672">.</span>0<span style="color:#f92672">&lt;</span>serving<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">]</span>

<span style="color:#66d9ef">let</span> optimizedPlanRevenue <span style="color:#f92672">=</span>
    futureDays
    <span style="color:#f92672">|&gt;</span> List.sumBy <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> RevenueModel.evaluate revenuePerServing optimizedPlan d<span style="color:#f92672">.</span>FoodDemand<span style="color:#f92672">)</span>
</code></pre></div><p><code>optimizedPlanRevenue</code> comes to $65,462.50, a 2.58% improvement. That will add up to significant additional revenue as the business scales. We now want to bring Mathematical Planning and Machine Learning together. We will use our Machine Learning models to predict the expected demand given the weather as input. The result of the prediction will be used as the input to the Mathematical Planning model which will suggest the ideal amount of inventory to carry.</p>
<p>I am going to gloss over some details that I will address in a future post at this point. I defined two new interfaces which cleaned up the code, <code>IDemandPredictor</code> and <code>IInventoryOptimizer</code>. They are simple interfaces I used to wrap the ML.NET model and the inventory optimization model. The <a href="https://github.com/matthewcrews/modelmondays/blob/main/FoodCartSeries/FoodCart-Part3.fsx">full example code</a> shows everything but for the sake of keeping this blog post a reasonable length, I left out these nuances.</p>
<p>In this code <code>burgerPredictor</code>, <code>pizzaPredictor</code> and <code>tacoPredictor</code> are instances of <code>IDemandPredictor</code> which wrap the ML.NET models we trained earlier. <code>planOptimizer</code> is an <code>IInventoryOptimizer</code> that wraps our Mathematical Planning model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#66d9ef">let</span> predictorPlusOptimizerRevenue <span style="color:#f92672">=</span>
    futureDays
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{|</span> d <span style="color:#66d9ef">with</span> DemandRates <span style="color:#f92672">=</span> Map <span style="color:#f92672">[</span> Burger<span style="color:#f92672">,</span> burgerPredictor<span style="color:#f92672">.</span>predict d<span style="color:#f92672">.</span>Weather
                                                        Pizza<span style="color:#f92672">,</span> pizzaPredictor<span style="color:#f92672">.</span>predict d<span style="color:#f92672">.</span>Weather
                                                        Taco<span style="color:#f92672">,</span> tacoPredictor<span style="color:#f92672">.</span>predict d<span style="color:#f92672">.</span>Weather
                                                      <span style="color:#f92672">]</span> <span style="color:#f92672">|})</span>
    <span style="color:#f92672">|&gt;</span> List.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{|</span> d <span style="color:#66d9ef">with</span> Plan <span style="color:#f92672">=</span> planOptimizer<span style="color:#f92672">.</span>plan d<span style="color:#f92672">.</span>DemandRates <span style="color:#f92672">|})</span>
    <span style="color:#f92672">|&gt;</span> List.sumBy <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> d <span style="color:#f92672">-&gt;</span> RevenueModel.evaluate revenuePerServing d<span style="color:#f92672">.</span>Plan d<span style="color:#f92672">.</span>FoodDemand<span style="color:#f92672">)</span>
</code></pre></div><p><code>predictorPlusOptimizerRevenue</code> comes to $67,214.30, a 7.98% improvement from our baseline. Here are the results side by side:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Simple Heuristic</th>
<th>MP</th>
<th>MP + ML</th>
</tr>
</thead>
<tbody>
<tr>
<td>Revenue</td>
<td>$62,247.20</td>
<td>$65,462.50</td>
<td>$67,214.30</td>
</tr>
<tr>
<td>% Improvement</td>
<td>-</td>
<td>2.58%</td>
<td>7.98%</td>
</tr>
</tbody>
</table>
<h2 id="next-steps">Next Steps</h2>
<p>I hope this illustrates a simple use case for combining the power of Mathematical Planning and Machine Learning. The techniques are highly complementary and lead to highly effective solutions which are far better than either technique in isolation. We can improve this solution in many ways. We spent no time on tuning the Machine Learning model. It would be nice to have real world data for this problem. The challenges is that the real world data sets I have access to are proprietary which is why I generated my own.</p>
<p>In future posts I hope to explore how to tune Machine Learning models to protect against specific failure modes by tuning for different metrics. We are also assuming that we restock the food cart every morning. We likely need to make inventory decisions several days ahead of time which introduces some interesting optimization challenges we will explore in the future.</p>
<p>Let me know if there are any problems you would like me to explore!</p>
<p>Please send me an email at <a href="mailto:matthewcrews@gmail.com">matthewcrews@gmail.com</a> if you have any questions and subscribe so you can stay on top new posts and products I am offering.</p>
<script async data-uid="32100bd90e" src="https://dedicated-trader-4923.ck.page/32100bd90e/index.js"></script>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="footer-inner">
          <h3 class="footer-title">Matthew Crews</h3>
          <div id="footer-menu" class="footer-menu">
  
</div>

          
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  MathJax = {
  tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
  };
</script>
<script id="MathJax-script" async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          
            
<div class="social">
    
        <a href="https://github.com/zerostaticthemes/hugo-serif-theme" target="blank"><img src="/images/social/github.svg" title="Github" alt="Github" /></a>
    
        <a href="https://twitter.com/zerostaticio" target="blank"><img src="/images/social/twitter.svg" title="Twitter" alt="Twitter" /></a>
    
</div>

          
          
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.98ee06cc35517b5800b382aecb0fc59893e95b9c11dd21842d0d57e4f68043e3.js"></script>
  

  






  





</body>

</html>
